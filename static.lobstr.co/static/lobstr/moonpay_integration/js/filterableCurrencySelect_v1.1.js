"use strict";(function($){$(function(){var $currencySelect=$('.filterablecurrencyselec2twidget');$currencySelect.each(function(index){var $item=$(this),$form=$item.closest('form'),$submitButton=$form.find('[type="submit"]');$.ajax({type:'GET',url:$item.attr('data-source')+'?page_size=all',success:function(response){$submitButton.prop('disabled',false);var initialValue=$item.val();$item.find('option').remove();$item.select2({data:[{'text':gettext('Popular currencies'),'children':response.results.filter(function(item){return item.is_popular;}).map(function(item){item.id=item.code;return item;})},{'text':gettext('All currencies'),'children':response.results.filter(function(item){return!item.is_popular;}).map(function(item){item.id=item.code;return item;})}],dropdownParent:$item.closest('.input-group'),width:'100%',templateSelection:function(item){var $option=$('<span class="d-flex select2-option align-items-center"><img class="currency-icon" /> <div><div class="code"></div> <div class="name"></div></div></span>');$option.find(".code").text(item.code);$option.find(".name").text(item.name);$option.find("img").attr("src",item.icon);return $option;},templateResult:function(item){if(item.text){return item.text;}
var $option=$('<span class="select2-option"><img class="currency-icon" /> <span class="code"></span> <span class="name"></span></span>');$option.find(".code").text(item.code);$option.find(".name").text(item.name);$option.find("img").attr("src",item.icon);return $option;},matcher:function(params,data){if($.trim(params.term)===''){return data;}
if(typeof data.text==='undefined'){return null;}
var dataCopy=$.extend({},data);dataCopy.children=[];for(var i=0;i<data.children.length;i++){if(data.children[i].name.toUpperCase().indexOf(params.term.toUpperCase())>-1||data.children[i].code.toUpperCase().indexOf(params.term.toUpperCase())>-1){dataCopy.children.push(data.children[i]);}}
if(dataCopy.children.length==0){return null;}
return dataCopy;}});$item.val(initialValue);$item.trigger('change');$item.on('select2:open',function(e){var $searchContainer=$item.closest('.input-group').find('.select2-container .select2-search');if($searchContainer.find('.fa-search').length==0){$searchContainer.prepend('<span class="fa fa-search"></span>');}
$item.closest('.input-group').find('.select2-container input').attr("placeholder",gettext("Type currency name or ticker"));if($searchContainer.find('.close-icon').length==0){$searchContainer.append('<span class="close-icon"></span>');$searchContainer.find('.close-icon').on('click',function(e){e.preventDefault();$item.select2('close');})}})},});});});})($);