var ASSET_TRUST_LINK=$('#asset-trust-url').attr('data-value');var ASSET_REMOVE_LINK=$('#asset-remove-url').attr('data-value');var IS_NATIVE='is_native';var sendAssetClickHandler=function(e){e.preventDefault();var code=$(this).attr('data-asset-code'),issuer=$(this).attr('data-asset-issuer');if(code){$('#id-send-form').find("#id_currency_code").val(code);$('#id-send-form').find("#id_currency_issuer").val(issuer);$('#id-send-form').find("#id_currency_code").trigger('change');$('#id-send-form').find("#id_currency_issuer").trigger('change');}
$('#send-modal').modal('show');e.stopPropagation();};var showAssetSuccessAlert=function(message){$('.transaction-error-alert').html(message).removeClass('alert-danger').addClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden').removeClass('alert-success').addClass('alert-danger');},5000);}
var showAssetUnsuccessfulAlert=function(message){$('.transaction-error-alert').html(message).addClass('alert-danger').removeClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden');},5000);}
var trustlineRequestErrorHandler=function(err,actionURL,actionMethod,assetCode,assetIssuer){$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');var response=err.responseJSON;var errors=response.errors;if(response.status=="needed_additional_signature"){$('#asset-details').modal('hide');window.showMoreSignaturesNeededPopup(response.detail,response.envelope_xdr);return;}
var errorText=gettext("Something went wrong!");if(response.message){errorText=response.message;}else if(response.detail){errorText=response.detail;}
$('.transaction-error-alert').html(errorText).addClass('alert-danger').removeClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('#asset-details').modal('hide');$('html').animate({scrollTop:0},500,'swing');};var trustlineRequestSuccessHandler=function(data){$('#asset-details').modal('hide');if(!data.detail){$('.transaction-error').hide();window.location.reload();}else{showAssetSuccessAlert(data.detail);$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');}};var modernTrustlineRequestSuccessHandler=function(data){$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');if(!data.detail){$('.transaction-error').hide();}else{$('.transaction-error-alert').html(data.detail).removeClass('alert-danger').addClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden').removeClass('alert-success').addClass('alert-danger');},5000);}}
var getActionLinkHandler=function(success,error){return function(event){event.preventDefault();if(!$(this).hasClass('in-progress')&&!$(this).hasClass('ignore')){$(this).addClass('start-spinner');$('.asset-action-link').addClass('in-progress');}else{return;}
$('.transaction-error-alert').addClass('hidden');var method="POST",assetCode=$(this).attr('data-asset-code'),assetIssuer=$(this).attr('data-asset-issuer'),actionURL=$(this).attr('href');if($(this).hasClass('remove-trustline-button')){method="DELETE";}
return $.ajax({type:method,url:actionURL,data:{"asset_code":assetCode,"asset_issuer":assetIssuer},beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),}).then(function(d){return transactionSigner.signTransaction(d.xdr);}).then(function(xdr){return sendXdrToHorizon(xdr);}).done(function(data){return success(data);}).catch(function(err){error(err,actionURL,method,assetCode,assetIssuer);});}}
var actionLinkClickHandler=getActionLinkHandler(trustlineRequestSuccessHandler,trustlineRequestErrorHandler);var modernActionLinkClickHandler=getActionLinkHandler(modernTrustlineRequestSuccessHandler,trustlineRequestErrorHandler);var initializeAssetImageClick=function(){var selector=$('.featured-assets .asset-info .asset-info-header .asset-info-header-image-wrapper, '+'.featured-assets .asset-info .asset-info-header .asset-info-header-name, '+'.fluid-table .cell.asset-info-cell .asset-info-cell-name, '+'.fluid-table .cell.asset-info-cell .asset-info-cell-image-wrapper, '+'.fluid-table .cell .transferable-asset-icon');selector.unbind('click');selector.on('click',function(event){if(!$(this).closest('.asset-wrapper').hasClass('no-popup')){$('.asset-wrapper.active-row').removeClass('active-row')
$(this).closest('.asset-wrapper').addClass('active-row');$('#asset-details').modal('show');}});};var showAssetsNotFoundMessage=function(){$('.trusted-asset-list').addClass('hidden');$('.search-asset-list').addClass('hidden');$('.my-assets-section .more').addClass('hidden');$('.trust-allowed-asset-list').addClass('hidden');$('.no-assets-message').removeClass('hidden');};var orderAssetsByAttribute=function(assets,attribute){return assets.sort(function(a,b){if(a[attribute]){return-1;}else if(!a[attribute]&&b[attribute]){return 1;}
return(b.raw_amount-a.raw_amount);});};var orderAssetsByLumen=function(assets){return assets.sort(function(a,b){if(a.code=='XLM'&&((a.issuer||null)===null)){return-1;};if(b.code=='XLM'&&((b.issuer||null)===null)){return 1;};return 0;});};var orderAssetsByAlternativeBalance=function(assets){return assets.sort(function(a,b){const aAlternativeBalance=a.alternative_balance?+a.alternative_balance.value:0;const bAlternativeBalance=b.alternative_balance?+b.alternative_balance.value:0;if(aAlternativeBalance>bAlternativeBalance){return-1;}
if(aAlternativeBalance<bAlternativeBalance){return 1;}
return 0;});}
var orderAssetsByBalance=function(assets){var _getBalance=function(balance){if(balance===undefined||balance===null){return-1;}else{return parseFloat(balance);}}
return assets.sort(function(a,b){const aBalance=_getBalance(a.raw_amount);const bBalance=_getBalance(b.raw_amount);if(aBalance>bBalance){return-1;}
if(aBalance<bBalance){return 1;}
return 0;});}
var orderByFeatured=function(assets){return assets.sort(function(a,b){if(a.featured&&!b.featured){return-1;}
if(!a.featured&&b.featured){return 1;}
return 0;});}
var orderAssetsByHomeDomain=function(assets){return assets.sort(function(a,b){if(Boolean(a.home_domain)&&!Boolean(b.home_domain)){return-1;}
if(!Boolean(a.isVerified)&&Boolean(b.isVerified)){return 1;}
return 0;});}
var orderAssetsByAssetCode=function(assets){return assets.sort(function(a,b){if(a.code>b.code){return 1;}
if(a.code<b.code){return-1;}
return 0;});}
var lobstrSort=function(assets){var mappedAssets=assets.map(function(asset,i){var balance=asset.raw_amount;if(balance===undefined||balance===null){balance=-1;}else{balance=parseFloat(balance);}
return{'index':i,'code':asset.code.toUpperCase(),'isNative':asset.code==='XLM'&&((asset.issuer||null)===null),'isFeatured':asset.featured,'isTrustAllowed':asset.trust_allowed,'isVerified':Boolean(asset.home_domain),'balance':balance,'alternativeBalance':asset.alternative_balance?+asset.alternative_balance.value:0,'trustlines':asset.trustlines,};});mappedAssets.sort(function(a,b){if(a.isNative){return-1;};if(b.isNative){return 1;};if(a.alternativeBalance>b.alternativeBalance){return-1;}
if(a.alternativeBalance<b.alternativeBalance){return 1;}
if(a.balance>b.balance){return-1;}
if(a.balance<b.balance){return 1;}
if(a.isFeatured&&!b.isFeatured){return-1;}
if(!a.isFeatured&&b.isisFeatured){return 1;}
if(a.isTrustAllowed&&!b.isTrustAllowed){return-1;}
if(!a.isTrustAllowed&&b.isTrustAllowed){return 1;}
if(a.isVerified&&!b.isVerified){return-1;}
if(!a.isVerified&&b.isVerified){return 1;}
if(a.trustlines>b.trustlines){return-1;}
if(a.trustlines<b.trustlines){return 1;}
if(a.code>b.code){return 1;}
if(a.code<b.code){return-1;}
return 0;});var result=mappedAssets.map(function(asset){return assets[asset.index];});return result;}
var createAssetsListBlock=function(assets){return Handlebars.templates._assets_list_block({'asset_balances':assets,'user_confirmed':$('#user-confirmed').attr('data-value')=="true",'settings_url':$('#settings-url').attr('data-value'),'trust_endpoint':ASSET_TRUST_LINK,'trade_base_url':$('#trade-view-url-template').attr('data-value'),'transfer_icon':$('#transfer-icon-url').attr('data-value'),});};var checkIsAccountActive=function(){var wallet=window.getCurrentUserWallet();var nativeAsset=StellarSdk.Asset.native();var nativeBalance=wallet.getAssetBalanceByAssetData(nativeAsset.code);if(nativeBalance&&parseFloat(nativeBalance.raw_amount)==0){return false;}
return true;}
var initializeAssetsListBlock=function(assetsListBlock){assetsListBlock.tooltip({trigger:"hover",selector:'.transferable-asset-icon',placement:"bottom"});assetsListBlock.find('.asset-info-cell-image-wrapper img').on('error',assetFillerErrorEventHandler);assetsListBlock.on('click','.trust-not-allowed.asset-action-link',function(event){event.preventDefault();var isAccountActive=checkIsAccountActive();if(!isAccountActive){$('#zero-lumens-modal').modal('show');return;}
var $this=$(this);var $assetWrapper=$this.closest('.asset-wrapper');var code=$assetWrapper.attr('data-asset-code');var issuer=$assetWrapper.attr('data-asset-issuer');var asset=new StellarSdk.Asset(code,issuer);asset.icon=$assetWrapper.attr('data-icon');asset.background_color=$assetWrapper.attr('data-background_color');asset.name=$assetWrapper.attr('data-name');asset.home_domain=$assetWrapper.attr('data-home_domain');var html=Handlebars.templates.empty_change_trust_warning_popup_content({'asset':asset,});$('#change-trust-warning-content').html(html);$(document).trigger('fill-icon-fillers');var $changeTrustWarningModal=$('#change-trust-warning-modal');var $confirmChangeTrustButton=$changeTrustWarningModal.find('.confirm-change-trust')
$confirmChangeTrustButton.off('click');$confirmChangeTrustButton.on('click',function(event){$('#change-trust-warning-modal').modal('hide');var bindActionLinkClickHandler=actionLinkClickHandler.bind($this);bindActionLinkClickHandler(event);});$changeTrustWarningModal.modal('show');});assetsListBlock.on('click','.trust-allowed.asset-action-link',function(event){var isAccountActive=checkIsAccountActive();if(!isAccountActive){event.preventDefault();$('#zero-lumens-modal').modal('show');return;}
var bindActionLinkClickHandler=actionLinkClickHandler.bind(this);bindActionLinkClickHandler(event);});assetsListBlock.on('click','.redirectable-button',redirectableButtonHandler);$('.no-assets-message').addClass('hidden');};var checkTrustAllowedAssetsExists=function(){if($('.trust-allowed-asset-list.hidden .row.data').length>0){$('.my-assets-section .more .add-other-asset').addClass('hidden');$('.my-assets-section .more').removeClass('hidden');$('.my-assets-section .more .all-assets-button').removeClass('hidden');};};var getAssetAlternativeRate=function(){return $.ajax({type:"POST",dataType:'JSON',contentType:'application/json; charset=utf-8',data:JSON.stringify(assets),url:$('#asset-details-url').attr('data-value'),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};;"use strict";var loadAssetAlternativeRate=function(asset){if(!asset){return Promise.resolve(null);}
if(!asset.issuer){var url=$('#lumen-alternative-rate-url').attr('data-value');}else{var url=$('#asset-alternative-rate-url').attr('data-value').replace('YYYYYYY',asset.code).replace('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX',asset.issuer)}
return $.ajax({type:"GET",dataType:'JSON',contentType:'application/json; charset=utf-8',url:url,beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};var loadListAssetsAlternativeRates=function(assets){if(!assets||assets.length<=0){return Promise.resolve(null);}
var asset=assets[0];if(asset.constructor==StellarSdk.Asset||asset.constructor==Asset){assets=assets.map(item=>{return{'code':item.code,'issuer':item.issuer||null};});}
return $.ajax({type:"POST",dataType:'JSON',contentType:'application/json; charset=utf-8',url:$('#list-alternative-rates-url').attr('data-value'),data:JSON.stringify(assets),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};;"use strict";$(function(){$(document).trigger('fill-icon-fillers');var wallet=window.getCurrentUserWallet();$("#navigation a[href='/user-assets/']").addClass('active-menu');var asset=null;var nativeAsset=StellarSdk.Asset.native();var horizon=new StellarSdk.Server(HORIZON_CONFIG.HORIZON_URL);var getAccountInfo=null;var getNativeToAlternativeRate=null;var getAssetToNativeRate=null;var getVolume24h=null;var handleAsset=function(){asset=new StellarSdk.Asset($('.selected-asset').attr('data-asset-code'),$('.selected-asset').attr('data-asset-issuer'))
asset.id=$('.selected-asset').attr('data-asset-id');asset.name=$('.selected-asset').attr('data-asset-name');asset.home_domain=$('.selected-asset').attr('data-asset-domain');}
var isLiquidityPoolTrade=function(trade){return trade.trade_type=='liquidity_pool';}
var isMinimalAmountsTrade=function(baseAmount,counterAmount){return baseAmount==0.0000001&&counterAmount==0.0000001}
var initSendFormSelectAsset=function(){var balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(!balance||parseFloat(balance.raw_amount)<=0){return;}
$('#id-send-form').find("#id_currency_code").val(asset.code);$('#id-send-form').find("#id_currency_issuer").val(asset.issuer);$('#id-send-form').find("#id_currency_code").trigger('change');$('#id-send-form').find("#id_currency_issuer").trigger('change');}
var clearSendFormSelectAsset=function(){var code=$('#id-send-form').find("#id_currency_code").val();var issuer=$('#id-send-form').find("#id_currency_issuer").val();if(code!=asset.code||issuer!=asset.issuer){return;}
var balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(balance&&parseFloat(balance.raw_amount)>0){return;}
$('#id-send-form').find("#id_currency_code").val(nativeAsset.code);$('#id-send-form').find("#id_currency_issuer").val(nativeAsset.issuer);$('#id-send-form').find("#id_currency_code").trigger('change');$('#id-send-form').find("#id_currency_issuer").trigger('change');}
var initRequestPaymentFormSelectAsset=function(){var balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(!balance){return;}
$("#id_request_payment_currency_code").val(asset.code);$("#id_request_payment_currency_issuer").val(asset.issuer);$("#id_request_payment_currency").html(asset.code);}
var clearRequestPaymentFormSelectAsset=function(){var code=$("#id_request_payment_currency_code").val();var issuer=$("#id_request_payment_currency_issuer").val();if(code!=asset.code||issuer!=asset.issuer){return;}
var balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(balance){return;}
$("#id_request_payment_currency_code").val(nativeAsset.code);$("#id_request_payment_currency_issuer").val(nativeAsset.issuer);$("#id_request_payment_currency").html(nativeAsset.code);}
$('.asset-details-content .send-asset').on('click',sendAssetClickHandler);$('.remove-trustline-button').on('click',function(event){event.preventDefault();let balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(balance&&parseFloat(balance.raw_amount)>0){return showAssetUnsuccessfulAlert(gettext('Asset can be removed when balance is 0'));}
let $dropdownButton=$('#more-actions-dropdown');$dropdownButton.removeAttr('data-toggle');var clickHandler=modernActionLinkClickHandler.bind(this);clickHandler(event).then(success=>{$dropdownButton.attr('aria-expanded',false);$('.action-button-group .dropdown-menu').removeClass('show');$dropdownButton.attr('data-toggle','dropdown');if(!success){return;}
if(success.status==='passed_to_multisig_service'){return;}
clearSendFormSelectAsset();clearRequestPaymentFormSelectAsset();$('.action-button-group').addClass('hidden');$('.not-trust-button-group').removeClass('hidden');})});var addTrustlineHandler=function(event){event.preventDefault();let nativeBalance=wallet.getAssetBalanceByAssetData(nativeAsset.code);if(nativeBalance){if(HORIZON_CONFIG.ENTRY_RESERVE>nativeBalance.available_amount){return showAssetUnsuccessfulAlert(gettext("Not enough XLM available to add an asset. Make sure you have at least {0} XLM available on your account before proceeding to add an asset.").format(HORIZON_CONFIG.ENTRY_RESERVE));}
if(HORIZON_CONFIG.ENTRY_RESERVE+HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM>nativeBalance.available_amount){return showAssetUnsuccessfulAlert(gettext("Not enough XLM available to add an asset. LOBSTR reserves an extra {0} XLM on your account balance to prevent your account from being locked.").format(HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM));}}
var clickHandler=modernActionLinkClickHandler.bind(this);clickHandler(event).then(success=>{if(!success){return;}
if(success.status==='passed_to_multisig_service'){return;}
$('.not-trust-button-group').addClass('hidden');$('.action-button-group').removeClass('hidden');})};$('.confirm-change-trust').on('click',function(event){$('#change-trust-warning-modal').modal('hide');var bindAddTrustlineHandler=addTrustlineHandler.bind($('.trust-not-allowed.add-trustline-button'));bindAddTrustlineHandler(event);});$('.trust-not-allowed.add-trustline-button').on('click',function(event){event.preventDefault();var isAccountActive=checkIsAccountActive();if(!isAccountActive){$('#zero-lumens-modal').modal('show');return;}
$('#change-trust-warning-modal').modal('show');})
$('.trust-allowed.add-trustline-button').on('click',function(event){var isAccountActive=checkIsAccountActive();if(!isAccountActive){event.preventDefault();$('#zero-lumens-modal').modal('show');return;}
var bindAddTrustlineHandler=addTrustlineHandler.bind(this);bindAddTrustlineHandler(event);});$('.request-money').on('click',function(event){$('#id-request-payment-form').find('.close-request-money').addClass('hidden');$('#id-request-payment-form').find('.close-popup-button').removeClass('hidden');$('#receive-popup').modal('show');$('#receive-popup').find('.request-money-button').trigger('click');});var validateWithdrawBalance=function(){let balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(!wallet.address){return true;}
if(!balance||parseFloat(balance.raw_amount)<=0){showAssetUnsuccessfulAlert(gettext('Withdrawals become available when the asset balance is more than 0'));return false;}
if(balance.available_amount==0){showAssetUnsuccessfulAlert(gettext('Withdrawals are not available as your balance is locked in an active trading offer. Close the offer to withdraw funds.'));return false;}
return true;}
$('.withdraw-button').on('click',function(event){var isValidBalanceForWithdraw=validateWithdrawBalance()
if(!isValidBalanceForWithdraw){event.preventDefault();}})
var renderSelectTransferServerPopUp=function(title,subtitle,operationUrl,transferServerList){var html=Handlebars.templates._asset_transfer_select_popup({'id':asset.id,'name':asset.name,'code':asset.code,'close_icon_url':$('#close-icon-url').attr('data-value'),'title':title,'subtitle':subtitle,'operationUrl':operationUrl,'transferServerList':transferServerList,});$('#asset-select-transfer').find('.modal-content.popup-content').html(html);$('#asset-select-transfer').modal('show');}
$('.select-deposit-transfer-server').on('click',function(event){event.preventDefault();let depositServerList=$(this).attr('data-deposit-server-list')&&JSON.parse($(this).attr('data-deposit-server-list'))||[];let title=window.gettext('Choose Deposit Partner');let subtitle=window.interpolate('There are several trusted partners that provide %(asset_code)s deposit services. '+'Please choose one that works best for you.',{asset_code:asset.code},true,);let operationUrl=$(this).attr('href');renderSelectTransferServerPopUp(title,subtitle,operationUrl,depositServerList);})
$('.select-withdraw-transfer-server').on('click',function(event){event.preventDefault();var isValidBalanceForWithdraw=validateWithdrawBalance()
if(!isValidBalanceForWithdraw){return;}
let withdrawServerList=$(this).attr('data-withdraw-server-list')&&JSON.parse($(this).attr('data-withdraw-server-list'))||[];let title=window.gettext('Choose Withdrawal Partner');let subtitle=window.interpolate('There are several trusted partners that provide %(asset_code)s withdrawal services. '+'Please choose one that works best for you.',{asset_code:asset.code},true,);let operationUrl=$(this).attr('href');renderSelectTransferServerPopUp(title,subtitle,operationUrl,withdrawServerList);})
$('.select-history-transfer-server').on('click',function(event){event.preventDefault();let transferHistoryServerList=$(this).attr('data-transfer-history-server-list')&&JSON.parse($(this).attr('data-transfer-history-server-list'))||[];let title=window.gettext('History of Deposits and Withdrawals');let subtitle=window.interpolate('There are several trusted partners that provide %(asset_code)s transfer services. '+'Choose the partner you used to deposit or withdraw %(asset_code)s to view the history of your past transfers.',{asset_code:asset.code},true,);let operationUrl=$(this).attr('href');renderSelectTransferServerPopUp(title,subtitle,operationUrl,transferHistoryServerList);})
$("body").on('submit','#select_transfer_server_form',function(event){event.preventDefault();var operationUrl=$(this).attr('data-operation-url');var transferServerId=$(this).find('[name="transfer_server"]:checked').val();window.location=operationUrl.replace(/\/$/,'')+'/'+transferServerId+'/';});$("body").on('click','#select_transfer_server_form input[name="transfer_server"]',function(event){$('#select_transfer_server_form [type="submit"]').prop('disabled',false);});$("body").on('click','#select_transfer_server_form .back-button',function(event){$('#asset-select-transfer').modal('hide');});var handleActionButtons=function(){let balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(!balance){$('.action-button-group').addClass('hidden');$('.not-trust-button-group').removeClass('hidden');}else{$('.not-trust-button-group').addClass('hidden');$('.action-button-group').removeClass('hidden');}}
var handleTransferButtons=function(){$('.transfer-button-group .asset-action-link').removeClass('in-progress');}
var handleBalance=function(){let balance=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);if(!balance){return $('.your-balance-group').addClass('hidden');}else{$('.your-balance-group').removeClass('hidden');}
let availableAmount=balance.available_amount;let humanizeAvailableAmount=humanizeNumber(availableAmount);let humanizeReservedBalance=humanizeNumber(balance.reserved_amount);$(".available-balance").html("{0} {1}".format(humanizeAvailableAmount,balance.code));$(".reserved-balance").html("{0} {1}".format(humanizeReservedBalance,balance.code));$(".reserved-balance-info").removeClass('hidden');};var handleAlternativeAvailableBalance=function(){Promise.all([getAccountInfo,getNativeToAlternativeRate,getAssetToNativeRate]).then(results=>{var balanceResult=wallet.getAssetBalanceByAssetData(asset.code,asset.issuer);var nativeToAlternativeRate=results[1];var assetToNativeRate=results[2];if(!balanceResult||!nativeToAlternativeRate||!assetToNativeRate){return $(".available-alternative-balance").html("--");}
if(balanceResult.is_native&&nativeToAlternativeRate.code=="xlm"){return;}
var assetToAlternativeRate=assetToNativeRate*nativeToAlternativeRate.rate;var availableAlternativeBalance=balanceResult.available_amount*assetToAlternativeRate;var humanizeAvailableAlternativeBalance=humanizeNumber(availableAlternativeBalance);$(".available-alternative-balance").html("{0}{1}".format(nativeToAlternativeRate.symbol,humanizeAvailableAlternativeBalance));}).catch(()=>$(".available-alternative-balance").html("--"));}
var handleSupply=function(){var totalSupply=$('.total-supply').attr('data-total-supply');if(!totalSupply){return $('.total-supply').html('--');}
$('.total-supply').html("{0} {1}".format(intWord(totalSupply),asset.code));}
var updateAssetToNativeRate=function(){if(asset.isNative()){getAssetToNativeRate=Promise.resolve(1.0);}else{getAssetToNativeRate=horizon.trades().forAssetPair(asset,nativeAsset).order('desc').limit(10).call().then(response=>{if(response.records.length<=0){return null}
var trades=response.records
var price=null;for(var i=0;i<trades.length;i++){var trade=trades[i];var baseAmount=parseFloat(trade.base_amount)
var counterAmount=parseFloat(trade.counter_amount)
if(isLiquidityPoolTrade(trade)&&isMinimalAmountsTrade(baseAmount,counterAmount)){if(!price){price=parseInt(trade.price.n)/parseInt(trade.price.d);}
continue}
price=parseInt(trade.price.n)/parseInt(trade.price.d);break;}
if(!price){return null;}
return price;}).catch(()=>null);}}
var handleAssetDetailsLight=function(){wallet.loadAssetDetailsLight().then(()=>{handlerPaymentQRAssets();}).catch()};var handleVolume24h=function(){Promise.all([getVolume24h,getNativeToAlternativeRate,getAssetToNativeRate]).then(results=>{var volume24h=results[0]
var nativeToAlternativeRate=results[1];var assetToNativeRate=results[2];if(!volume24h||!nativeToAlternativeRate||!assetToNativeRate){return $(".volume-24h").html('--');}
var assetToAlternativeRate=assetToNativeRate*nativeToAlternativeRate.rate;var volume24hToAlternative=volume24h*assetToAlternativeRate;var humanizeVolume24hToAlternative=intWord(volume24hToAlternative);$(".volume-24h").html("{0}{1}".format(nativeToAlternativeRate.symbol,humanizeVolume24hToAlternative));}).catch(()=>$(".volume-24h").html('--'));}
var handleMarketCap=function(){var totalSupply=$('.market-cap').attr('data-total-supply');if(!totalSupply){return $('.market-cap').html('--');}
Promise.all([getNativeToAlternativeRate,getAssetToNativeRate]).then(results=>{var nativeToAlternativeRate=results[0];var assetToNativeRate=results[1];if(!nativeToAlternativeRate||!assetToNativeRate){return $('.market-cap').html('--');}
var assetToAlternativeRate=assetToNativeRate*nativeToAlternativeRate.rate;var marketCapAlternative=parseFloat(totalSupply)*assetToAlternativeRate;var humanizeMarketCapAlternative=intWord(marketCapAlternative);$('.market-cap').html("{0}{1}".format(nativeToAlternativeRate.symbol,humanizeMarketCapAlternative));}).catch(()=>$('.market-cap').html('--'));}
var handlePrice=function(){Promise.all([getNativeToAlternativeRate,getAssetToNativeRate]).then(results=>{var nativeToAlternativeRate=results[0];var assetToNativeRate=results[1];if(!nativeToAlternativeRate||!assetToNativeRate){return $('.price-alternative').html('--');}
var assetToAlternativeRate=assetToNativeRate*nativeToAlternativeRate.rate;var priceToAlternative=1.0*assetToAlternativeRate;var humanizePriceToAlternative=humanizeNumber(priceToAlternative);$('.price-alternative').html("{0}{1}".format(nativeToAlternativeRate.symbol,humanizePriceToAlternative));}).catch(()=>$('.price-alternative').html('--'));}
var handlerPaymentQRAssets=function(){var menu=$('#payment-qr-modal .dropdown-menu');var assets=wallet.allBalances;updateCurrencyDropdownMenuContent(menu,assets);}
var startTradesStream=function(){horizon.trades().forAssetPair(asset,nativeAsset).cursor('now').stream({onmessage:function(trade){var baseAmount=parseFloat(trade.base_amount)
var counterAmount=parseFloat(trade.counter_amount)
if(baseAmount==0||counterAmount==0){return}
if(isLiquidityPoolTrade(trade)&&isMinimalAmountsTrade(baseAmount,counterAmount)){return}
getAssetToNativeRate=Promise.resolve(parseInt(trade.price.n)/parseInt(trade.price.d));handleAlternativeAvailableBalance();handlePrice();handleVolume24h();handleMarketCap();}});}
var updateNativeToAlternativeRate=function(){getNativeToAlternativeRate=loadAssetAlternativeRate({'code':nativeAsset.code,'issuer':nativeAsset.issuer||null}).then(details=>{setTimeout(updateNativeToAlternativeRate,10000);handleAlternativeAvailableBalance();handlePrice();handleVolume24h();handleMarketCap();return details.alternative_rate;}).catch(()=>{setTimeout(updateNativeToAlternativeRate,60000);return null});}
var updateVolume24h=function(){let data={"query":"{ markets(numHoursAgo: 24 baseAssetCode: \"{0}\" counterAssetCode: \"{1}\" counterAssetIssuer: \"{2}\") { counterVolume } }".format(nativeAsset.code,asset.code,asset.issuer,)};getVolume24h=$.ajax({type:"POST",url:'https://ticker.stellar.org/graphql',contentType:"application/json",data:JSON.stringify(data),}).then(response=>{setTimeout(updateVolume24h,10000);let data=response.data;if(!data){return}
let markets=data.markets
if(!markets){return}
let market=markets[0]
if(!market){return}
handleVolume24h();return response.data.markets[0].counterVolume}).fail(()=>{setTimeout(updateVolume24h,60000);return null;})}
var handleRequests=function(){updateNativeToAlternativeRate();updateAssetToNativeRate();if(!asset.isNative()){updateVolume24h();startTradesStream();}}
var handleSuccessLoadAccountInfo=function(){handleTransferButtons();handleActionButtons();initSendFormSelectAsset();initRequestPaymentFormSelectAsset();handleBalance();handleAlternativeAvailableBalance();handlerPaymentQRAssets();handleAssetDetailsLight();}
var handleFailLoadAccountInfo=function(){handleTransferButtons();handleActionButtons();handleBalance();}
handleAsset();handleSupply();handleRequests();getAccountInfo=wallet.loadAccountInfo(handleSuccessLoadAccountInfo,handleFailLoadAccountInfo);wallet.addRunAutoSynchronizerCallbacks(handleTransferButtons);wallet.addRunAutoSynchronizerCallbacks(handleActionButtons);wallet.addRunAutoSynchronizerCallbacks(clearSendFormSelectAsset);wallet.addRunAutoSynchronizerCallbacks(clearRequestPaymentFormSelectAsset);wallet.addRunAutoSynchronizerCallbacks(handleBalance);wallet.addRunAutoSynchronizerCallbacks(handleAlternativeAvailableBalance);wallet.addRunAutoSynchronizerCallbacks(handlerPaymentQRAssets);wallet.addRunAutoSynchronizerCallbacks(handleAssetDetailsLight);if(!wallet.address){handleTransferButtons();}});;$(function(){var $reservedBalancePopup=$('#reserved-balance-modal');var wallet=window.getCurrentUserWallet();var HORIZON_CONFIG=window.HORIZON_CONFIG;function showReservedBalance(assetCode,assetIssuer){if(isReservedBalanceOpened()){$reservedBalancePopup.one('hidden.bs.modal',function(){showReservedBalance(assetCode,assetIssuer);});$reservedBalancePopup.modal('hide');}
$reservedBalancePopup.find('#reserved-balance-content').html(Handlebars.templates._reserved_balance_table(getBalanceStatusContext(assetCode,assetIssuer)));$reservedBalancePopup.modal('show');}
function isReservedBalanceOpened(){return($reservedBalancePopup.data('bs.modal')||{_isShown:false})._isShown;}
function getBalanceStatusContext(assetCode,assetIssuer){var balanceStatusData=[];var assetBalance=wallet.getAssetBalanceByAssetData(assetCode,assetIssuer),availableBalance=assetBalance.available_amount,accountInfo=wallet._accountInfo;if(assetBalance.is_native){availableBalance=availableBalance-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;availableBalance=availableBalance.toFixed(7);if(availableBalance<0){availableBalance=0;};balanceStatusData.push({title:gettext('Base reserve'),count:1,amount:1});var assetsCount=accountInfo.balances.filter(item=>item.asset_type!='liquidity_pool_shares').length-1;var liquidityPoolCount=accountInfo.balances.filter(item=>item.asset_type=='liquidity_pool_shares').length;var balancesCount=assetsCount+(liquidityPoolCount*2);balanceStatusData.push({title:gettext('Trustlines (assets)'),count:assetsCount,amount:assetsCount*HORIZON_CONFIG.ENTRY_RESERVE});balanceStatusData.push({title:gettext('Trustlines (liquidity pools)'),count:liquidityPoolCount,amount:liquidityPoolCount*HORIZON_CONFIG.ENTRY_RESERVE*2});var signersCount=accountInfo.signers.length-1;balanceStatusData.push({title:gettext('Signers'),count:signersCount,amount:signersCount*HORIZON_CONFIG.ENTRY_RESERVE});var dataEntriesCount=Object.keys(accountInfo.data_attr).length;balanceStatusData.push({title:gettext('Account data'),count:dataEntriesCount,amount:dataEntriesCount*HORIZON_CONFIG.ENTRY_RESERVE});var offersCount=accountInfo.subentry_count-balancesCount-signersCount-dataEntriesCount;balanceStatusData.push({title:gettext('Offers created'),count:offersCount,amount:offersCount*HORIZON_CONFIG.ENTRY_RESERVE});}
balanceStatusData.push({title:gettext('{0} in active offers').format(assetBalance.code),count:'',amount:assetBalance.selling_liabilities.toString(),});if(assetBalance.is_native){var sponsoringCount=accountInfo.num_sponsoring;balanceStatusData.push({title:gettext('Sponsoring others'),count:'',amount:sponsoringCount*HORIZON_CONFIG.ENTRY_RESERVE});var sponsoredCount=accountInfo.num_sponsored;if(sponsoredCount>0){sponsoredCount=sponsoredCount*-1;}
balanceStatusData.push({title:gettext('Sponsored for you'),count:'',amount:sponsoredCount*HORIZON_CONFIG.ENTRY_RESERVE});}
return{assetBalance:assetBalance,availableBalance:availableBalance,balanceStatusData:balanceStatusData};}
$(document).on('click','[data-toggle="reserved-balance"]',function(e){e.preventDefault();showReservedBalance($(this).attr('data-code'),$(this).attr('data-issuer'));});});;var showErrors=function($form,response){hideErrors($form);var errors=null;if(response){errors=response.errors;}
if(!errors){errors=response;}
if(!errors){showFormErrorsV2($form,{'detail':gettext('Something went wrong.')});return;}
for(var fieldName in errors){var $field=$form.find('[name="'+fieldName+'"]');if($field.length>0&&errors[fieldName]){$field.addClass('is-invalid invalid');$field.closest('.form-group').addClass('has-error');for(var i=0,error;error=errors[fieldName][i];i++){$field.parent().append('<span class="error-message invalid-feedback">'+error+'</span>');}}}
var extraFields=['non_field_errors','detail','__all__'],$nonFieldErrors=$form.find('.non-field-errors');for(var i=0,error;i<extraFields.length;i++){error=errors[extraFields[i]];if(error){var $errorList=$nonFieldErrors.find('ul');if(!$errorList[0]){$errorList=$('<ul></ul>');$nonFieldErrors.append($errorList);}
$nonFieldErrors.removeClass('hidden');$errorList.append('<li>'+error+'</li>');}}};var showFormErrorsV2=function($form,response){hideFormErrorsV2($form);var errors=null;if(response){errors=response.errors;}
if(!errors){errors=response;}
if(!errors){showFormErrorsV2($form,{'detail':gettext('Something went wrong.')});return;}
window.test=errors;for(var fieldName in errors){var $field=$form.find('[name="'+fieldName+'"]');if($field.length>0&&errors[fieldName]){$field.addClass('is-invalid');var $formGroup=$field.closest('.form-group');$formGroup.addClass('has-error');for(var i=0,error;error=errors[fieldName][i];i++){$formGroup.find('.field-bottom-group').append('<span class="form-text help-text invalid-feedback">'+error+'</span>')}}}
var extraFields=['non_field_errors','detail','__all__'],$nonFieldErrors=$form.find('.non-field-errors');for(var i=0,error;i<extraFields.length;i++){error=errors[extraFields[i]];if(error){var $errorList=$nonFieldErrors.find('ul');if(!$errorList[0]){$errorList=$('<ul></ul>');$nonFieldErrors.append($errorList);}
$errorList.append('<li>'+error+'</li>');$nonFieldErrors.removeClass('hidden');}}}
var hideFormErrorsV2=function($form){$form.find('.non-field-errors').html('').addClass('hidden');$form.removeClass('has-error').find('.form-group').removeClass('has-error').find('.is-invalid').removeClass('is-invalid').find('.invalid-feedback').remove();}
var hideInputErrorV2=function($input){$input.removeClass('is-invalid').closest('.form-group').removeClass('has-error').find('.invalid-feedback').remove();}
var hideErrors=function($form){$form.find('.non-field-errors').html('').addClass('hidden');$form.find('.is-invalid').removeClass('is-invalid invalid');$form.find('.has-error').removeClass('has-error');$form.find('.error-message, .invalid-feedback').remove();};var hideInputFieldErrors=function($inputField){$inputField.closest('.has-error').removeClass('has-error');$inputField.removeClass('is-invalid invalid');};Chart.plugins.register({afterDatasetsDraw:function(chart){var drawCircle=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,x=activePoint.tooltipPosition().x,y=activePoint.tooltipPosition().y;ctx.beginPath();ctx.arc(x,y,4,0,2*Math.PI,false);ctx.fillStyle='#FFFFFF';ctx.fill();ctx.lineWidth=3;ctx.strokeStyle='#00abff';ctx.stroke();};function roundRect(ctx,x,y,width,height,radius,fill,stroke){if(typeof stroke=='undefined'){stroke=true;}
if(typeof radius==='undefined'){radius=5;}
if(typeof radius==='number'){radius={tl:radius,tr:radius,br:radius,bl:radius};}else{var defaultRadius={tl:0,tr:0,br:0,bl:0};for(var side in defaultRadius){radius[side]=radius[side]||defaultRadius[side];}}
ctx.beginPath();ctx.moveTo(x+radius.tl,y);ctx.lineTo(x+width-radius.tr,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius.tr);ctx.lineTo(x+width,y+height-radius.br);ctx.quadraticCurveTo(x+width,y+height,x+width-radius.br,y+height);ctx.lineTo(x+radius.bl,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius.bl);ctx.lineTo(x,y+radius.tl);ctx.quadraticCurveTo(x,y,x+radius.tl,y);ctx.closePath();if(fill){ctx.fill();}
if(stroke){ctx.strokeStyle=stroke;ctx.stroke();}}
var drawVerticalLine=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],x=activePoint.tooltipPosition().x,y=activePoint.tooltipPosition().y,topY=y_axis.top,bottomY=y_axis.bottom;ctx.save();ctx.beginPath();ctx.moveTo(x,topY);ctx.lineTo(x,bottomY);ctx.lineWidth=3;ctx.strokeStyle='#00abff';ctx.stroke();ctx.restore();};var drawYValue=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],topY=y_axis.top,x=activePoint.tooltipPosition().x,verticalPadding=5;var text="{0} {1}".format(activePoint._chart.config.data.datasets[0].data[activePoint._index].y,activePoint._chart.config.data.datasets[0].label);ctx.lineWidth=1;ctx.fillStyle='#FFFFFF';var horizontalPadding=10,startX=x-ctx.measureText(text).width/2-horizontalPadding-(ctx.lineWidth/2),endX=x+ctx.measureText(text).width/2+horizontalPadding,textHeight=12;if(ctx.canvas.clientWidth<endX){startX=ctx.canvas.clientWidth-(endX-startX);}
if(chart.scales['y-axis-0'].right>startX){startX=chart.scales['y-axis-0'].right;}
roundRect(ctx,startX,1,ctx.measureText(text).width+2*horizontalPadding,textHeight+2*verticalPadding,6,"#FFFFFF",'#00abff');ctx.font="{0}px Ubuntu".format(textHeight);ctx.fillStyle="rgba(0, 0, 0, 0.54)";ctx.textBaseline='middle';ctx.textAlign="left";ctx.fillText(text,startX+horizontalPadding,topY+ctx.lineWidth-12);};var drawXValue=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],topY=y_axis.top,bottomY=y_axis.bottom,x=activePoint.tooltipPosition().x,verticalPadding=5;var text="{0}".format(chart.labels[activePoint._index]);var horizontalPadding=10,startX=x-ctx.measureText(text).width/2-horizontalPadding,endX=x+ctx.measureText(text).width/2+horizontalPadding,textHeight=12;ctx.lineWidth=1;ctx.fillStyle='#FFFFFF';if(ctx.canvas.clientWidth<endX){startX=ctx.canvas.clientWidth-(endX-startX);}
if(chart.scales['y-axis-0'].right>startX){startX=chart.scales['y-axis-0'].right-2;}
var areaHeight=textHeight+2*verticalPadding+2*ctx.lineWidth;roundRect(ctx,startX,bottomY-areaHeight/2,ctx.measureText(text).width+2*horizontalPadding,areaHeight,6,"#FFFFFF",'rgba(234, 234, 234, 0.78)');ctx.font="{0}px Ubuntu".format(textHeight);ctx.fillStyle="rgba(0, 0, 0, 0.54)";ctx.textBaseline='middle';ctx.textAlign="left";ctx.fillText(text,startX+horizontalPadding,bottomY);};if(chart.tooltip._active&&chart.tooltip._active.length){drawVerticalLine(chart);drawCircle(chart);drawYValue(chart);drawXValue(chart);}}});;$(function(){var myNewChart;var LABELS_COUNT=4;var DAY='DAY';var WEEK='WEEK';var MONTH='MONTH';var THREE_MONTHS='THREE_MONTHS';var YEAR='YEAR';var START_X_LABEL_PADDING=0.07;var displayPeriodChoices={'DAY':24,'WEEK':168,'MONTH':720,'THREE_MONTHS':2160,'YEAR':8760,};var timeFormatChoices={DAY:'LT',WEEK:'ddd hh A',MONTH:'MMM, DD',THREE_MONTHS:'MMM DD, YYYY',YEAR:'MMM, YYYY',};var baseStepChoicesForAssetChart={DAY:900000,WEEK:3600000,MONTH:86400000,THREE_MONTHS:86400000,YEAR:604800000,};var baseStepChoicesForLumenChart={DAY:600000,};var lastClickTimestamp=Date.now();var getDisplayPeriod=function(period){if(period<=displayPeriodChoices.DAY){return DAY;}else if(period<=displayPeriodChoices.WEEK){return WEEK;}else if(period<=displayPeriodChoices.MONTH){return MONTH;}else if(period<=displayPeriodChoices.THREE_MONTHS){return THREE_MONTHS;}else if(period){return YEAR;}
return YEAR;}
var updateCharts=function(){var period=$('.chart-periods .period.selected').attr('data-value');var periodKey=getDisplayPeriod(period);var counterAsset=null,baseAsset=new Asset({'code':StellarSdk.Asset.native().code,'issuer':StellarSdk.Asset.native().issuer});$('.chart .chart-loader-wrapper').show();if($('.selected-asset').length==2){counterAsset=new Asset({'code':$('.selected-asset.counter-asset').attr('data-asset-code'),'issuer':$('.selected-asset.counter-asset').attr('data-asset-issuer')||null});baseAsset=new Asset({'code':$('.selected-asset.base-asset').attr('data-asset-code'),'issuer':$('.selected-asset.base-asset').attr('data-asset-issuer')||null});}else if($('.selected-asset').length>0){counterAsset=new Asset({'code':$('.selected-asset').attr('data-asset-code'),'issuer':$('.selected-asset').attr('data-asset-issuer')||null});}
if(!counterAsset||(counterAsset.is_native&&baseAsset.is_native)){drawLobstrDataChart(period,periodKey);}else{drawAggregatedChart(period,periodKey,counterAsset,baseAsset);}};var drawAggregatedChart=function(period,periodKey,counterAsset,baseAsset){var CONFIG=window.HORIZON_CONFIG;var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);var resolution=baseStepChoicesForAssetChart[periodKey];var currencyCode=$('#chart-currency-code').attr('data-value');var clickTimestamp=Date.now();var lastClickTimestamp=clickTimestamp;if(period){var start_time=moment().subtract(moment.duration(parseInt(period),'h')).unix()*1000;}else{var start_time=moment("2014-01-01").unix()*1000;}
horizon.tradeAggregation(counterAsset.getStellarObject(),baseAsset.getStellarObject(),start_time,moment().unix()*1000+resolution,resolution,0).limit(200).call().then(function(response){if(lastClickTimestamp>clickTimestamp){return;}
resetChartHandler();var data=response.records;if(!data||data.length<2){return renderChartEmptyState();}
var open=parseFloat(data[0].open);var close=parseFloat(data[data.length-1].close);var rates=data.map(function(item){return{x:new Date(parseInt(item.timestamp)),y:parseFloat(item.avg)}});var extremeValues=data.reduce(function(a,b){var aHigh=parseFloat(a.high);var aLow=parseFloat(a.low);var bHigh=parseFloat(b.high);var bLow=parseFloat(b.low);return{high:Math.max(aHigh,bHigh),low:Math.min(aLow,bLow)}});return renderChart(counterAsset,currencyCode,rates,periodKey,resolution,open,close,extremeValues.high,extremeValues.low,baseAsset);}).catch(()=>{showNoDataMessage();$('.chart  .chart-loader-wrapper').hide();});};var drawLobstrDataChart=function(period,periodKey){var currencyCode=$('#chart-currency-code').attr('data-value');var resolution=baseStepChoicesForLumenChart[periodKey];var clickTimestamp=Date.now();var lastClickTimestamp=clickTimestamp;if(currencyCode==='XLM'){currencyCode='USD';}
var url=$('#exchange-rates-url').attr('data-value')+"?page_size=all&currency="+currencyCode+"&end_timestamp="+moment().unix();if(period){period=parseInt(period);url+="&start_timestamp="+moment().subtract(moment.duration(parseInt(period),'h')).unix();}
$.ajax({async:true,type:"GET",url:url,}).done(function(response){if(lastClickTimestamp>clickTimestamp){return;}
resetChartHandler();var data=response.results;if(!data||data.length<2){return renderChartEmptyState();}
var open=data[0].reverse_rate;var close=data[data.length-1].reverse_rate;var rates=data.map(function(item){return{x:new Date(item.timestamp*1000),y:item.reverse_rate}});var sortedDataValues=data.map(function(item){return item.reverse_rate}).sort();var low=sortedDataValues[0];var high=sortedDataValues[sortedDataValues.length-1];return renderChart(null,currencyCode,rates,periodKey,resolution,open,close,high,low);});};var showNoDataMessage=function(){$('.chart .box-content').addClass('hidden');$('.chart .no-chart-data-message').removeClass('hidden');$('.chart .chart-last-rate-info').addClass('invisible');};var hideNoDataMessage=function(){$('.chart .box-content').removeClass('hidden');$('.chart .no-chart-data-message').addClass('hidden');$('.chart .chart-last-rate-info').removeClass('invisible');};var getLabels=function(rates,periodKey,resolution){var labels=[];var min=new Date(rates[0].x);var max=new Date(rates[rates.length-1].x);var timeDifference=(max-min);var timeStep=timeDifference*(1-(START_X_LABEL_PADDING*2))/(LABELS_COUNT-1);var baseOffset=timeDifference*START_X_LABEL_PADDING;min.setTime(min.getTime()+baseOffset);var isNeedRoundLabels=function(timeDifference,periodKey,resolution){if(periodKey==DAY){return(timeDifference/(LABELS_COUNT+1))>=resolution}
return false};var isNeedRound=isNeedRoundLabels(timeDifference,periodKey,resolution);var roundTimeByPeriod=function(timestamp,resolution){return Math.round(timestamp/resolution)*resolution;};for(var i=0;i<LABELS_COUNT;i++){if(isNeedRound){min.setTime(roundTimeByPeriod(min.getTime(),resolution));}
labels.push(min);min=new Date(min.getTime()+timeStep);}
return labels};var getDatasetConfig=function(labelText,rates){return{label:labelText,pointRadius:0,fill:true,lineTension:0.1,borderWidth:1.5,data:rates};};var getOptions=function(periodKey,min,max){var updateYTicksOptions=function(ticks,min,max){var isValuesEqual=max==min;if(!isValuesEqual){return;}
if(max<=0){ticks['max']=0.0000001;ticks['min']=0;return;}
var DEFAULT_VALUE_CHANGE=0.1
var iterator=0;var approximation=null;var maxValue;var minValue;var valueDigit;do{valueDigit=Math.floor(Math.log10(max));valueDigit+=iterator;maxValue=Math.ceil10((max*(1+DEFAULT_VALUE_CHANGE)),valueDigit);minValue=Math.floor10((min*(1-DEFAULT_VALUE_CHANGE)),valueDigit);approximation=(max/maxValue)/(minValue/max);iterator-=1;}while(!approximation||(approximation<0.9||approximation>1.1));ticks['max']=maxValue;ticks['min']=minValue;};var layout={padding:{top:24,left:-5,},};var tooltips={enabled:false,mode:'x-axis',displayColors:false,callbacks:{title:function(){return"";}}};var xAxes=[{gridLines:{display:false},type:'time',time:{displayFormats:{hour:timeFormatChoices[periodKey],},unit:'hour',},ticks:{maxRotation:0,minRotation:0,padding:8,source:'labels',},afterFit:(scale)=>{scale.paddingRight=0;},}];var yAxes=[{gridLines:{display:false},ticks:{maxTicksLimit:6,padding:8,labelOffset:-5,},}];updateYTicksOptions(yAxes[0].ticks,min,max);var scales={xAxes:xAxes,yAxes:yAxes,};var legend={display:false,};return{layout:layout,tooltips:tooltips,scales:scales,legend:legend,};}
var renderChartEmptyState=function(){showNoDataMessage();$('.chart  .chart-loader-wrapper').hide();$('.box-header').show();}
var renderChart=function(counterAsset,currencyCode,rates,periodKey,resolution,open,close,high,low,baseAsset){var wallet=window.getCurrentUserWallet();var name=$('#chart-name').attr('data-value');var ctx=$("#"+name).get(0).getContext("2d");var wallet=window.getCurrentUserWallet();var ratesValues=[]
var labels=[]
if(!counterAsset&&!baseAsset){var labelText=currencyCode;}else{var labelText=baseAsset.code;}
if(!rates||rates.length===0){showNoDataMessage();}else{hideNoDataMessage();};$('.chart  .chart-loader-wrapper').hide();$('.box-header').show();if(rates.length<=1){myNewChart=new Chart(ctx,{type:'line',});wallet.runSynchronizerCallbacks();return};var ratesValues=rates.map(function(item){return item.y;});var sorted_rates=ratesValues.slice().sort(function(a,b){return(+a)-(+b);});var current=parseFloat(ratesValues[ratesValues.length-1]);renderStatInfo(name,current,labelText,low,high);labels=getLabels(rates,periodKey,resolution);var datasetConfig=getDatasetConfig(labelText,rates);setChartColorScheme(datasetConfig,ctx,name,open,close);var chart_data={labels:labels,datasets:[datasetConfig,]};var options=getOptions(periodKey,low,high);myNewChart=new Chart(ctx,{type:'line',data:chart_data,options:options});myNewChart.labels=rates.map(function(item,index){return moment(item.x).format("HH:mm DD-MM-YYYY");});wallet.runSynchronizerCallbacks();};var setChartColorScheme=function(datasetConfig,ctx,name,open,close){var line_color=null;var gradient=ctx.createLinearGradient(0,0,0,200);var change=0;if(open&&close){change=((close/open)-1)*100;}
change=parseFloat(change).toFixed(2);if(change>=0){if(change==0){$('#'+name+'_total').text('(0%)');$('.rate-img').attr('src','');}else{$('#'+name+'_total').text('(+ '+change+'%)');}
$('#'+name+'_total').addClass('green');gradient.addColorStop(0,'rgba(138,199,170,1)');gradient.addColorStop(1,'rgba(138,199,170,0)');line_color="#50c794";}else{$('#'+name+'_total').addClass('red');$('#'+name+'_total').text('(- '+(-change)+'%)');gradient.addColorStop(0,'rgba(255,100,100,1)');gradient.addColorStop(1,'rgba(255,100,100,0)');line_color="#D28273";}
datasetConfig.borderColor=line_color;datasetConfig.backgroundColor=gradient;};var renderStatInfo=function(name,current,labelText,min,max){$('#'+name+'_current').html('<span class="value">{0}</span> <span class="code">{1}</span>'.format(truncateZeros(current.toFixed(7)),labelText));$('#'+name+'_min').text('L: '+truncateZeros(min.toFixed(7)));$('#'+name+'_max').text('H: '+truncateZeros(max.toFixed(7)));};var resetStatInfo=function(name){$('#'+name+'_current').html('0');$('#'+name+'_min').text('L: 0');$('#'+name+'_max').text('H: 0');};updateCharts();var resetChartHandler=function(){if(myNewChart){resetStatInfo($('#chart-name').attr('data-value'));myNewChart.destroy();}};$(document).on('updateRateChart',function(){updateCharts();});$(document).on('resetRateChart',resetChartHandler);$('.chart-periods .period').on('click',function(e){$('.chart-periods .period').removeClass('selected');$(this).addClass('selected');$(document).trigger('updateRateChart');});});;"use strict";$(function(){$('#payment-qr-amount').on('input',function(event){if(parseFloat($(this).val())>0){$('#payment-qr-modal').find('.create-qr-button').prop('disabled',false);}else{$('#payment-qr-modal').find('.create-qr-button').prop('disabled',true);}})
$('#payment-qr-modal').on('hidden.bs.modal',function(){$('#payment-qrcode-form')[0].reset();$('#payment-qrcode-content').addClass('hidden');$('.request-payment-qrcode-content').removeClass('hidden');});$('#payment-qrcode-form').on('submit',function(event){event.preventDefault();var code=$('#id_request_qrcode_asset_code').val();var issuer=$('#id_request_qrcode_asset_issuer').val()||null;var amount=$('#payment-qr-amount').val();var wallet=window.getCurrentUserWallet();var balance=wallet.getAssetBalanceByAssetData(code,issuer);var html=Handlebars.templates.payment_qrcode_popup_content({'asset':balance,'amount':amount});var $paymentQRCodeContent=$('#payment-qrcode-content')
$paymentQRCodeContent.html(html);var qrcodeUrl="web+stellar:pay?destination={0}&amount={1}&asset_code={2}".format(wallet.address,amount,code,)
if(!balance.is_native){qrcodeUrl+="&asset_issuer={0}".format(issuer)}
new QRCode(document.getElementById("payment-qrcode"),{"text":qrcodeUrl,"width":"256","height":"256"});$paymentQRCodeContent.find('.back-button').on('click',function(event){event.preventDefault();$paymentQRCodeContent.addClass('hidden');$('.request-payment-qrcode-content').removeClass('hidden');})
$('.request-payment-qrcode-content').addClass('hidden');$paymentQRCodeContent.removeClass('hidden');$paymentQRCodeContent.find('.close-popup-button').focus();})});;"use strict";$(function(){$('#zero-lumens-modal').find('.to-receive').on('click',function(event){event.preventDefault;$('#zero-lumens-modal').modal('hide');$('#receive-popup').modal('show');})});;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['payment_qrcode_popup_content']=template({"1":function(container,depth0,helpers,partials,data){var stack1;return"        <div class=\"asset-code\">"
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),depth0))
+((stack1=helpers["if"].call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.home_domain:stack1),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"</div>\n";},"2":function(container,depth0,helpers,partials,data){var stack1;return" ("
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.home_domain:stack1),depth0))
+")";},"4":function(container,depth0,helpers,partials,data){var stack1;return"        <div class=\"asset-code\">"
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+((stack1=helpers["if"].call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.home_domain:stack1),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"</div>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3=container.escapeExpression,alias4="function",alias5=container.lambda;return"<div class=\"description\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Use this QR code to share a direct link to",{"name":"_","hash":{},"data":data}))
+" "
+alias3(((helper=(helper=helpers.amount||(depth0!=null?depth0.amount:depth0))!=null?helper:alias2),(typeof helper===alias4?helper.call(alias1,{"name":"amount","hash":{},"data":data}):helper)))
+" ("
+alias3(alias5(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+") "
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"payment",{"name":"_","hash":{},"data":data}))
+"</div>\n<div class=content-body>\n    <div id=\"payment-qrcode\"></div>\n    <div class=\"asset-amount\">"
+alias3(((helper=(helper=helpers.amount||(depth0!=null?depth0.amount:depth0))!=null?helper:alias2),(typeof helper===alias4?helper.call(alias1,{"name":"amount","hash":{},"data":data}):helper)))
+" "
+alias3(alias5(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")
+"</div>\n<div class=\"links\">\n    <a href=\"#\" class=\"f-right new-button back-button\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Back",{"name":"_","hash":{},"data":data}))
+"</a>\n    <a href=\"#\" data-dismiss=\"modal\" class=\"f-right new-button green close-popup-button\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Done",{"name":"_","hash":{},"data":data}))
+"</button>\n</div>";},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['_asset_transfer_select_popup']=template({"1":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"            <div class=\"transfer-server-item-wrapper\">\n                <label>\n                    <input type=\"radio\" name=\"transfer_server\" value=\""
+alias2(alias1((depth0!=null?depth0.id:depth0),depth0))
+"\" />\n\n                    <div class=\"transfer-server-item\">\n                        <div class=\"transfer-server-icon\">\n                            <img src=\""
+alias2(alias1((depth0!=null?depth0.icon:depth0),depth0))
+"\" />\n                        </div>\n\n                        <div class=\"transfer-server-info\">\n                            <div class=\"transfer-server-name\">\n                                "
+alias2(alias1((depth0!=null?depth0.name:depth0),depth0))
+"\n                            </div>\n                            <div class=\"transfer-server-desc\">\n                                "
+alias2(alias1((depth0!=null?depth0.short_description:depth0),depth0))
+"\n                            </div>\n                        </div>\n                    </div>\n                </label>\n            </div>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression;return"<button class=\"close-popup close-popup-button close\" type=\"button\" data-dismiss=\"modal\">\n    <button class=\"close-popup close-popup-button close\" type=\"button\" data-dismiss=\"modal\">\n        <img src=\""
+alias4(((helper=(helper=helpers.close_icon_url||(depth0!=null?depth0.close_icon_url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"close_icon_url","hash":{},"data":data}):helper)))
+"\">\n    </button>\n</button>\n\n<div class=\"header\">\n    "
+alias4(((helper=(helper=helpers.title||(depth0!=null?depth0.title:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"title","hash":{},"data":data}):helper)))
+"\n</div>\n\n<div class=\"header-info\">\n    "
+alias4(((helper=(helper=helpers.subtitle||(depth0!=null?depth0.subtitle:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"subtitle","hash":{},"data":data}):helper)))
+"\n</div>\n\n<form id=\"select_transfer_server_form\" action=\"javascript:void(0);\" method=\"post\" data-operation-url=\""
+alias4(((helper=(helper=helpers.operationUrl||(depth0!=null?depth0.operationUrl:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"operationUrl","hash":{},"data":data}):helper)))
+"\">\n    <div class=\"transfer-server-list\">\n"
+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.transferServerList:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"    </div>\n\n    <div class=\"links\">\n        <button class=\"f-right new-button back-button\" type=\"button\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Back",{"name":"_","hash":{},"data":data}))
+"</button>\n        <button class=\"f-right new-button green\" type=\"submit\" disabled>"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Continue",{"name":"_","hash":{},"data":data}))
+"</button>\n    </div>\n</form>\n";},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['_reserved_balance_table']=template({"1":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"    <tr>\n        <td>"
+alias2(alias1((depth0!=null?depth0.title:depth0),depth0))
+"</td>\n        <td>"
+alias2(alias1((depth0!=null?depth0.count:depth0),depth0))
+"</td>\n        <td>"
+alias2(alias1((depth0!=null?depth0.amount:depth0),depth0))
+"</td>\n    </tr>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3=container.escapeExpression,alias4=container.lambda;return"<table class=\"table striped-table reserved-balance-table\">\n    <tr>\n        <th scope=\"col\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Entry type",{"name":"_","hash":{},"data":data}))
+"</th>\n        <th scope=\"col\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Amount",{"name":"_","hash":{},"data":data}))
+"</th>\n        <th scope=\"col\">"
+alias3(alias4(((stack1=(depth0!=null?depth0.assetBalance:depth0))!=null?stack1.code:stack1),depth0))
+"</th>\n    </tr>\n"
+((stack1=helpers.each.call(alias1,(depth0!=null?depth0.balanceStatusData:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"    <tr class=\"total\">\n        <td>"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Total reserved",{"name":"_","hash":{},"data":data}))
+"</td>\n        <td></td>\n        <td>"
+alias3(alias4(((stack1=(depth0!=null?depth0.assetBalance:depth0))!=null?stack1.reserved_amount:stack1),depth0))
+"</td>\n    </tr>\n    <tr class=\"total\">\n        <td>"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Available Balance",{"name":"_","hash":{},"data":data}))
+"</td>\n        <td></td>\n        <td>"
+alias3(((helper=(helper=helpers.availableBalance||(depth0!=null?depth0.availableBalance:depth0))!=null?helper:alias2),(typeof helper==="function"?helper.call(alias1,{"name":"availableBalance","hash":{},"data":data}):helper)))
+"</td>\n    </tr>\n</table>\n";},"useData":true});})();;