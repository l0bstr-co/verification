"use strict";$(function(){$('.input-group > .form-control').on('focus',function(){$(this).parent().addClass('focused');}).on('blur',function(){$(this).parent().removeClass('focused');});});;var ASSET_TRUST_LINK=$('#asset-trust-url').attr('data-value');var ASSET_REMOVE_LINK=$('#asset-remove-url').attr('data-value');var IS_NATIVE='is_native';var sendAssetClickHandler=function(e){e.preventDefault();var code=$(this).attr('data-asset-code'),issuer=$(this).attr('data-asset-issuer');if(code){$('#id-send-form').find("#id_currency_code").val(code);$('#id-send-form').find("#id_currency_issuer").val(issuer);$('#id-send-form').find("#id_currency_code").trigger('change');$('#id-send-form').find("#id_currency_issuer").trigger('change');}
$('#send-modal').modal('show');e.stopPropagation();};var showAssetSuccessAlert=function(message){$('.transaction-error-alert').html(message).removeClass('alert-danger').addClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden').removeClass('alert-success').addClass('alert-danger');},5000);}
var showAssetUnsuccessfulAlert=function(message){$('.transaction-error-alert').html(message).addClass('alert-danger').removeClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden');},5000);}
var trustlineRequestErrorHandler=function(err,actionURL,actionMethod,assetCode,assetIssuer){$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');var response=err.responseJSON;var errors=response.errors;if(response.status=="needed_additional_signature"){$('#asset-details').modal('hide');window.showMoreSignaturesNeededPopup(response.detail,response.envelope_xdr);return;}
var errorText=gettext("Something went wrong!");if(response.message){errorText=response.message;}else if(response.detail){errorText=response.detail;}
$('.transaction-error-alert').html(errorText).addClass('alert-danger').removeClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('#asset-details').modal('hide');$('html').animate({scrollTop:0},500,'swing');};var trustlineRequestSuccessHandler=function(data){$('#asset-details').modal('hide');if(!data.detail){$('.transaction-error').hide();window.location.reload();}else{showAssetSuccessAlert(data.detail);$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');}};var modernTrustlineRequestSuccessHandler=function(data){$('.asset-action-link').removeClass('in-progress');$('.asset-action-link').removeClass('start-spinner');if(!data.detail){$('.transaction-error').hide();}else{$('.transaction-error-alert').html(data.detail).removeClass('alert-danger').addClass('alert-success');$('.transaction-error-alert').removeClass('hidden');$('html').animate({scrollTop:0},500,'swing');setTimeout(function(){$('.transaction-error-alert').addClass('hidden').removeClass('alert-success').addClass('alert-danger');},5000);}}
var getActionLinkHandler=function(success,error){return function(event){event.preventDefault();if(!$(this).hasClass('in-progress')&&!$(this).hasClass('ignore')){$(this).addClass('start-spinner');$('.asset-action-link').addClass('in-progress');}else{return;}
$('.transaction-error-alert').addClass('hidden');var method="POST",assetCode=$(this).attr('data-asset-code'),assetIssuer=$(this).attr('data-asset-issuer'),actionURL=$(this).attr('href');if($(this).hasClass('remove-trustline-button')){method="DELETE";}
return $.ajax({type:method,url:actionURL,data:{"asset_code":assetCode,"asset_issuer":assetIssuer},beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),}).then(function(d){return transactionSigner.signTransaction(d.xdr);}).then(function(xdr){return sendXdrToHorizon(xdr);}).done(function(data){return success(data);}).catch(function(err){error(err,actionURL,method,assetCode,assetIssuer);});}}
var actionLinkClickHandler=getActionLinkHandler(trustlineRequestSuccessHandler,trustlineRequestErrorHandler);var modernActionLinkClickHandler=getActionLinkHandler(modernTrustlineRequestSuccessHandler,trustlineRequestErrorHandler);var initializeAssetImageClick=function(){var selector=$('.featured-assets .asset-info .asset-info-header .asset-info-header-image-wrapper, '+'.featured-assets .asset-info .asset-info-header .asset-info-header-name, '+'.fluid-table .cell.asset-info-cell .asset-info-cell-name, '+'.fluid-table .cell.asset-info-cell .asset-info-cell-image-wrapper, '+'.fluid-table .cell .transferable-asset-icon');selector.unbind('click');selector.on('click',function(event){if(!$(this).closest('.asset-wrapper').hasClass('no-popup')){$('.asset-wrapper.active-row').removeClass('active-row')
$(this).closest('.asset-wrapper').addClass('active-row');$('#asset-details').modal('show');}});};var showAssetsNotFoundMessage=function(){$('.trusted-asset-list').addClass('hidden');$('.search-asset-list').addClass('hidden');$('.my-assets-section .more').addClass('hidden');$('.trust-allowed-asset-list').addClass('hidden');$('.no-assets-message').removeClass('hidden');};var orderAssetsByAttribute=function(assets,attribute){return assets.sort(function(a,b){if(a[attribute]){return-1;}else if(!a[attribute]&&b[attribute]){return 1;}
return(b.raw_amount-a.raw_amount);});};var orderAssetsByLumen=function(assets){return assets.sort(function(a,b){if(a.code=='XLM'&&((a.issuer||null)===null)){return-1;};if(b.code=='XLM'&&((b.issuer||null)===null)){return 1;};return 0;});};var orderAssetsByAlternativeBalance=function(assets){return assets.sort(function(a,b){const aAlternativeBalance=a.alternative_balance?+a.alternative_balance.value:0;const bAlternativeBalance=b.alternative_balance?+b.alternative_balance.value:0;if(aAlternativeBalance>bAlternativeBalance){return-1;}
if(aAlternativeBalance<bAlternativeBalance){return 1;}
return 0;});}
var orderAssetsByBalance=function(assets){var _getBalance=function(balance){if(balance===undefined||balance===null){return-1;}else{return parseFloat(balance);}}
return assets.sort(function(a,b){const aBalance=_getBalance(a.raw_amount);const bBalance=_getBalance(b.raw_amount);if(aBalance>bBalance){return-1;}
if(aBalance<bBalance){return 1;}
return 0;});}
var orderByFeatured=function(assets){return assets.sort(function(a,b){if(a.featured&&!b.featured){return-1;}
if(!a.featured&&b.featured){return 1;}
return 0;});}
var orderAssetsByHomeDomain=function(assets){return assets.sort(function(a,b){if(Boolean(a.home_domain)&&!Boolean(b.home_domain)){return-1;}
if(!Boolean(a.isVerified)&&Boolean(b.isVerified)){return 1;}
return 0;});}
var orderAssetsByAssetCode=function(assets){return assets.sort(function(a,b){if(a.code>b.code){return 1;}
if(a.code<b.code){return-1;}
return 0;});}
var lobstrSort=function(assets){var mappedAssets=assets.map(function(asset,i){var balance=asset.raw_amount;if(balance===undefined||balance===null){balance=-1;}else{balance=parseFloat(balance);}
return{'index':i,'code':asset.code.toUpperCase(),'isNative':asset.code==='XLM'&&((asset.issuer||null)===null),'isFeatured':asset.featured,'isTrustAllowed':asset.trust_allowed,'isVerified':Boolean(asset.home_domain),'balance':balance,'alternativeBalance':asset.alternative_balance?+asset.alternative_balance.value:0,'trustlines':asset.trustlines,};});mappedAssets.sort(function(a,b){if(a.isNative){return-1;};if(b.isNative){return 1;};if(a.alternativeBalance>b.alternativeBalance){return-1;}
if(a.alternativeBalance<b.alternativeBalance){return 1;}
if(a.balance>b.balance){return-1;}
if(a.balance<b.balance){return 1;}
if(a.isFeatured&&!b.isFeatured){return-1;}
if(!a.isFeatured&&b.isisFeatured){return 1;}
if(a.isTrustAllowed&&!b.isTrustAllowed){return-1;}
if(!a.isTrustAllowed&&b.isTrustAllowed){return 1;}
if(a.isVerified&&!b.isVerified){return-1;}
if(!a.isVerified&&b.isVerified){return 1;}
if(a.trustlines>b.trustlines){return-1;}
if(a.trustlines<b.trustlines){return 1;}
if(a.code>b.code){return 1;}
if(a.code<b.code){return-1;}
return 0;});var result=mappedAssets.map(function(asset){return assets[asset.index];});return result;}
var createAssetsListBlock=function(assets){return Handlebars.templates._assets_list_block({'asset_balances':assets,'user_confirmed':$('#user-confirmed').attr('data-value')=="true",'settings_url':$('#settings-url').attr('data-value'),'trust_endpoint':ASSET_TRUST_LINK,'trade_base_url':$('#trade-view-url-template').attr('data-value'),'transfer_icon':$('#transfer-icon-url').attr('data-value'),});};var checkIsAccountActive=function(){var wallet=window.getCurrentUserWallet();var nativeAsset=StellarSdk.Asset.native();var nativeBalance=wallet.getAssetBalanceByAssetData(nativeAsset.code);if(nativeBalance&&parseFloat(nativeBalance.raw_amount)==0){return false;}
return true;}
var initializeAssetsListBlock=function(assetsListBlock){assetsListBlock.tooltip({trigger:"hover",selector:'.transferable-asset-icon',placement:"bottom"});assetsListBlock.find('.asset-info-cell-image-wrapper img').on('error',assetFillerErrorEventHandler);assetsListBlock.on('click','.trust-not-allowed.asset-action-link',function(event){event.preventDefault();var isAccountActive=checkIsAccountActive();if(!isAccountActive){$('#zero-lumens-modal').modal('show');return;}
var $this=$(this);var $assetWrapper=$this.closest('.asset-wrapper');var code=$assetWrapper.attr('data-asset-code');var issuer=$assetWrapper.attr('data-asset-issuer');var asset=new StellarSdk.Asset(code,issuer);asset.icon=$assetWrapper.attr('data-icon');asset.background_color=$assetWrapper.attr('data-background_color');asset.name=$assetWrapper.attr('data-name');asset.home_domain=$assetWrapper.attr('data-home_domain');var html=Handlebars.templates.empty_change_trust_warning_popup_content({'asset':asset,});$('#change-trust-warning-content').html(html);$(document).trigger('fill-icon-fillers');var $changeTrustWarningModal=$('#change-trust-warning-modal');var $confirmChangeTrustButton=$changeTrustWarningModal.find('.confirm-change-trust')
$confirmChangeTrustButton.off('click');$confirmChangeTrustButton.on('click',function(event){$('#change-trust-warning-modal').modal('hide');var bindActionLinkClickHandler=actionLinkClickHandler.bind($this);bindActionLinkClickHandler(event);});$changeTrustWarningModal.modal('show');});assetsListBlock.on('click','.trust-allowed.asset-action-link',function(event){var isAccountActive=checkIsAccountActive();if(!isAccountActive){event.preventDefault();$('#zero-lumens-modal').modal('show');return;}
var bindActionLinkClickHandler=actionLinkClickHandler.bind(this);bindActionLinkClickHandler(event);});assetsListBlock.on('click','.redirectable-button',redirectableButtonHandler);$('.no-assets-message').addClass('hidden');};var checkTrustAllowedAssetsExists=function(){if($('.trust-allowed-asset-list.hidden .row.data').length>0){$('.my-assets-section .more .add-other-asset').addClass('hidden');$('.my-assets-section .more').removeClass('hidden');$('.my-assets-section .more .all-assets-button').removeClass('hidden');};};var getAssetAlternativeRate=function(){return $.ajax({type:"POST",dataType:'JSON',contentType:'application/json; charset=utf-8',data:JSON.stringify(assets),url:$('#asset-details-url').attr('data-value'),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};;"use strict";var loadAssetAlternativeRate=function(asset){if(!asset){return Promise.resolve(null);}
if(!asset.issuer){var url=$('#lumen-alternative-rate-url').attr('data-value');}else{var url=$('#asset-alternative-rate-url').attr('data-value').replace('YYYYYYY',asset.code).replace('XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX',asset.issuer)}
return $.ajax({type:"GET",dataType:'JSON',contentType:'application/json; charset=utf-8',url:url,beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};var loadListAssetsAlternativeRates=function(assets){if(!assets||assets.length<=0){return Promise.resolve(null);}
var asset=assets[0];if(asset.constructor==StellarSdk.Asset||asset.constructor==Asset){assets=assets.map(item=>{return{'code':item.code,'issuer':item.issuer||null};});}
return $.ajax({type:"POST",dataType:'JSON',contentType:'application/json; charset=utf-8',url:$('#list-alternative-rates-url').attr('data-value'),data:JSON.stringify(assets),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),});};;"use strict";jQuery.validator.addMethod("notOnlyZero",function(value,element,param){return this.optional(element)||Number(value)>0;});var formValidationCommonConfig={rules:{amount:{required:true,notOnlyZero:'0',},price:{required:true,},},messages:{amount:{"notOnlyZero":gettext("Amount should be greater than zero"),},total:{"max":jQuery.validator.format(gettext("You can't trade more than {{0}} {0}").format($(".base-asset").attr("data-asset-code")))}},errorPlacement:function(error,element){element.closest('.form-group').append(error.addClass('error-message'));},highlight:function(element,errorClass){$(element).addClass(errorClass);$(element).closest('.form-group').addClass('has-error');},unhighlight:function(element,errorClass){$(element).removeClass(errorClass);$(element).closest('.form-group').removeClass('has-error');},errorClass:"invalid",};var getSellFormValidationRule=function(form){var wallet=window.getCurrentUserWallet();var formValidationConfig=jQuery.extend(true,{},formValidationCommonConfig);var asset=wallet.getAssetBalanceByAssetData($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));var maxAmount=asset?asset.available_amount:0;if(asset&&asset.is_native){maxAmount=maxAmount-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;if(form.is('#id-sell-limit-form')){maxAmount=maxAmount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
var base_asset=wallet.getAssetBalanceByAssetData($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));if(!base_asset){maxAmount=maxAmount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
maxAmount=Math.floor10(maxAmount,-7);}
if(maxAmount<0){maxAmount=0;}
formValidationConfig.rules.amount.max=maxAmount;return formValidationConfig;};var getBuyFormValidationRule=function(form){var wallet=window.getCurrentUserWallet();var formValidationConfig=jQuery.extend(true,{},formValidationCommonConfig);var asset=wallet.getAssetBalanceByAssetData($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));var maxAmount=asset?asset.available_amount:0;if(asset&&asset.is_native){maxAmount=maxAmount-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;if(form.is('#id-buy-limit-form')){maxAmount=maxAmount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
var base_asset=wallet.getAssetBalanceByAssetData($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));if(!base_asset){maxAmount=maxAmount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
maxAmount=Math.floor10(maxAmount,-7);}
if(maxAmount<0){maxAmount=0;}
formValidationConfig.rules.total={};formValidationConfig.rules.total.max=maxAmount;return formValidationConfig;};var failedRequestHandler=function(response,form,wallet){var response=response.responseJSON||{};var errors=response.errors;var generalError="Something went wrong!";form.find('[type="submit"]').prop('disabled',false);if(response.status=="needed_additional_signature"){window.showMoreSignaturesNeededPopup(response.detail,response.envelope_xdr);return;}
if(response.code=='action_required'||response.status=='action_required'){var html=Handlebars.templates.additional_action_required_popup({'message':response.detail,'asset':response.data.asset,'isAddButtons':true,});var $actionRequiredPopup=$('#additional-action-required');$actionRequiredPopup.find('.popup-content').html(html);$(document).trigger('fill-icon-fillers');$('.action-url').on('click',function(e){e.preventDefault();if(response.action_method=='GET'){window.open(response.action_url,'_blank','noopener,noreferrer');$actionRequiredPopup.modal('hide');}
var csrfToken=getCookie('csrftoken');$.ajax({type:response.action_method,dataType:'JSON',contentType:'application/json; charset=utf-8',url:response.action_url,data:JSON.stringify(response.context),beforeSend:beforeSendCSRFConfig(csrfToken),}).then(data=>{let nextUrl=data.next_url;window.open(nextUrl,'_blank','noopener,noreferrer');$actionRequiredPopup.modal('hide');}).catch(error=>{form.find(".alert").addClass("alert-danger").removeClass("alert-success").removeClass("hidden").html(gettext('Could not contact the asset issuer for {0} ({1}). Try again at a later time.').format(response.data.asset.code,response.data.asset.home_domain,));setTimeout(function(){form.find(".alert").addClass("hidden");},5000);$actionRequiredPopup.modal('hide');});});$actionRequiredPopup.modal('show');$('.action-url').focus();return;}
if(response.detail){generalError=response.detail;delete response.detail;}
if(errors&&Object.keys(errors).length>0){if(form.is('#id-sell-limit-form')||form.is('#id-sell-market-form')){form.validate(getSellFormValidationRule(form)).showErrors(errors);}else{form.validate(getBuyFormValidationRule(form)).showErrors(errors);}}else{form.find(".alert").addClass("alert-danger").removeClass("alert-success").removeClass("hidden").html(generalError);setTimeout(function(){form.find(".alert").addClass("hidden");},5000);}
$('.counter-asset-code').html($(".counter-asset").attr("data-asset-code"));if(wallet){wallet.loadAccountInfo(function(){wallet.runSynchronizerCallbacks();});}};var checkMarketStat=function(){if($('.statictic-block .statistic-item:visible').length==0){$('.statictic-block').addClass('hidden');}};$('#id-sell-type-form input').change(function(){let isMarketTrade=this.value==='market';$('#id-sell-market-form').toggleClass('show',isMarketTrade);$('#id-sell-limit-form').toggleClass('show',!isMarketTrade);});$('#id-buy-type-form input').change(function(){let isMarketTrade=this.value==='market';$('#id-buy-market-form').toggleClass('show',isMarketTrade);$('#id-buy-limit-form').toggleClass('show',!isMarketTrade);});var onMarketTypeDropdownItemClickHandler=function(e){e.preventDefault();var dropdownSelectField=$(this).closest('.dropdown-select-field');dropdownSelectField.find('.hidden-value[type="hidden"][name="type"]').val($(this).attr('data-value'));dropdownSelectField.find('.hidden-value[type="hidden"]').trigger('change');dropdownSelectField.find('.dropdown-toggle').html($(this).html());};$(function(){$('.markettypeselectwidget').parent().find('.dropdown-item').on('click',onMarketTypeDropdownItemClickHandler);});var checkAvailableNativeAmount=function(form){var wallet=window.getCurrentUserWallet();var native_asset_amount=wallet.nativeBalance.available_amount,amount=native_asset_amount-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;if(form.is('#id-sell-limit-form')||form.is('#id-buy-limit-form')){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
if(amount<0){form.find(".alert").addClass("alert-danger").removeClass("alert-success").removeClass("hidden").html(gettext('Not enough XLM to create this offer'));return false;}
if(form.is('#id-sell-limit-form')||form.is('#id-sell-market-form')){var balance=wallet.getAssetBalanceByAssetData($('.base-asset').attr('data-asset-code'),$('.base-asset').attr('data-asset-issuer'));}else{var balance=wallet.getAssetBalanceByAssetData($('.counter-asset').attr('data-asset-code'),$('.counter-asset').attr('data-asset-issuer'));}
if(!balance){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
if(amount<0){form.find(".alert").addClass("alert-danger").removeClass("alert-success").removeClass("hidden").html(gettext('Not enough XLM to add the asset'));return false;}
return true;};"use strict";function Offer(offer_object,relatedUserAddress){this.relatedUserAddress=relatedUserAddress;this.id=offer_object.id;this.amount=offer_object.amount;this.price=offer_object.price;this.seller=offer_object.seller;this.price_r=offer_object.price_r;this.selling=offer_object.selling;this.buying=offer_object.buying;Object.defineProperty(this,"is_selling",{get:function(){if((this.seller==this.relatedUserAddress&&this.selling.asset_type==StellarSdk.Asset.native().getAssetType())||(this.seller!=this.relatedUserAddress&&this.buying.asset_type==StellarSdk.Asset.native().getAssetType())){return false;}
return true;},});Object.defineProperty(this,"display_amount",{get:function(){var val=0;if(!this.is_selling){val=(this.amount*this.price);}else{val=this.amount;}
return truncateZeros(parseFloat(val).toFixed(9));},});Object.defineProperty(this,"total_amount",{get:function(){var val=0;if(this.is_selling){val=(this.amount*this.price);}else{val=this.amount;}
return truncateZeros(parseFloat(val).toFixed(9));},});Object.defineProperty(this,"price_display",{get:function(){if(!this.is_selling){return parseInt(this.price_r.d)/parseInt(this.price_r.n);}
return parseInt(this.price_r.n)/parseInt(this.price_r.d);},});Object.defineProperty(this,"selling_asset",{get:function(){if(this.selling.asset_type==StellarSdk.Asset.native().getAssetType()){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.selling.asset_code,this.selling.asset_issuer);}
return null;},});Object.defineProperty(this,"buying_asset",{get:function(){if(this.buying.asset_type==StellarSdk.Asset.native().getAssetType()){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.buying.asset_code,this.buying.asset_issuer);}
return null;},});};"use strict";function Trade(trade_object,userAddress){this.offer_id=trade_object.offer_id;this.base_account=trade_object.base_account;this.base_liquidity_pool_id=trade_object.base_liquidity_pool_id;this.base_amount=trade_object.base_amount;this.base_asset_type=trade_object.base_asset_type;this.base_asset_code=trade_object.base_asset_code;this.base_asset_issuer=trade_object.base_asset_issuer;this.counter_account=trade_object.counter_account;this.counter_liquidity_pool_id=trade_object.counter_liquidity_pool_id;this.counter_amount=trade_object.counter_amount;this.counter_asset_type=trade_object.counter_asset_type;this.counter_asset_code=trade_object.counter_asset_code;this.counter_asset_issuer=trade_object.counter_asset_issuer;this.base_is_seller=trade_object.base_is_seller;this.price=trade_object.price;this.price.n=parseInt(this.price.n);this.price.d=parseInt(this.price.d);this.paging_token=trade_object.paging_token;this.ledger_close_time=trade_object.ledger_close_time;Object.defineProperty(this,"is_selling",{get:function(){if(!(this.base_account==userAddress&&this.base_asset_type==StellarSdk.Asset.native().getAssetType())&&!(this.counter_account==userAddress&&this.counter_asset_type==StellarSdk.Asset.native().getAssetType())){return true;}
return false;},});Object.defineProperty(this,"selling_asset",{get:function(){if((!this.is_selling&&this.base_account==userAddress)||(this.is_selling&&this.base_account!=userAddress)){if(this.counter_asset_type=="native"){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.counter_asset_code,this.counter_asset_issuer);}}else{if(this.base_asset_type=="native"){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.base_asset_code,this.base_asset_issuer);}}
return null;},});Object.defineProperty(this,"buying_asset",{get:function(){if((!this.is_selling&&this.base_account==userAddress)||(this.is_selling&&this.base_account!=userAddress)){if(this.base_asset_type=="native"){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.base_asset_code,this.base_asset_issuer);}}else{if(this.counter_asset_type=="native"){return StellarSdk.Asset.native();}else{return new StellarSdk.Asset(this.counter_asset_code,this.counter_asset_issuer);}}
return null;},});Object.defineProperty(this,"selling_amount",{get:function(){if((!this.is_selling&&this.base_account==userAddress)||(this.is_selling&&this.base_account!=userAddress)){return this.counter_amount;}else{return this.base_amount;}
return null;},});Object.defineProperty(this,"buying_amount",{get:function(){if((!this.is_selling&&this.base_account==userAddress)||(this.is_selling&&this.base_account!=userAddress)){return this.base_amount;}else{return this.counter_amount;}
return null;},});Object.defineProperty(this,"selling_price",{get:function(){if((!this.is_selling&&this.base_account==userAddress)||(this.is_selling&&this.base_account!=userAddress)){return parseInt(this.price.d)/parseInt(this.price.n);}else{return parseInt(this.price.n)/parseInt(this.price.d);}
return null;},});};"use strict";$(function(argument){var CONFIG=window.HORIZON_CONFIG;var tradeHistoryPageLimit=10;var userAddress=$('#current-user-address').attr('data-value');if(!userAddress){return;}
var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);var getRenderedTrades=function(records){var transformedTrades=[];var trade=null;for(var i=0;i<records.length;i++){trade=new Trade(records[i],userAddress);transformedTrades.push(trade);}
return Handlebars.templates.trade_table_body({'trades':transformedTrades});};var initializeTradeTableEvents=function(){$('.history-row').on('click',function(event){var $this=$(this);var $popup=$('#trade-details-popup');var html=Handlebars.templates.trade_details_popup({'close_icon_url':$('#close-icon-url').attr('data-value'),'selling_asset':new Asset({'code':$this.attr('data-selling-code'),'issuer':$this.attr('data-selling-issuer')}),'buying_asset':new Asset({'code':$this.attr('data-buying-code'),'issuer':$this.attr('data-buying-issuer')}),'time':moment($this.attr('data-ledger-close-time')).format("MMMM D, YYYY [at] HH:mm"),'buying_amount':$this.attr('data-buying-amount'),'selling_amount':$this.attr('data-selling-amount'),});$popup.find('.popup-content').html(html);$popup.modal('show');});};horizon.trades().forAccount(userAddress).order('desc').limit(tradeHistoryPageLimit+1).call().then(function(response){if(response.records.length>0){var renderedTrades=getRenderedTrades(response.records.slice(0,tradeHistoryPageLimit));$('.trades-table').append(renderedTrades);initializeTradeTableEvents();}else{$('.trades-table').addClass('hidden');$('#trades-tab .empty-tab-message-wrapper').removeClass('hidden');}
if(tradeHistoryPageLimit+1>response.records.length){$('.load-more.history').parent().addClass('hidden');}else{$('.load-more.history').parent().removeClass('hidden');}
setTimeout(tradeUpdateFunction,10000);});$('.load-more.history').on('click',function(event){var $this=$(this);$this.prop('disabled',true);horizon.trades().forAccount(userAddress).order('desc').cursor($('.trades-table .data').last().attr('data-paging-token')).limit(tradeHistoryPageLimit+1).call().then(function(response){$this.prop('disabled',false);var renderedTrades=getRenderedTrades(response.records.slice(0,tradeHistoryPageLimit));$('.trades-table').append(renderedTrades);initializeTradeTableEvents();if(tradeHistoryPageLimit+1>response.records.length){$('.load-more.history').parent().addClass('hidden');}else{$('.load-more.history').parent().removeClass('hidden');}});});var tradeUpdateFunction=function(){var oldestTrade=$('.trades-table .data').first().attr('data-paging-token');horizon.trades().forAccount(userAddress).order('desc').limit(200).call().then(function(response){var newTrades=[];for(var i=0;i<response.records.length;i++){if(response.records[i].paging_token==oldestTrade){break;}
newTrades.push(response.records[i]);}
if(newTrades.length>0){var renderedTrades=getRenderedTrades(newTrades);var wallet=window.getCurrentUserWallet();$(renderedTrades).insertBefore($('.trades-table .row.data').first());$('#trades-tab .empty-tab-message-wrapper').addClass('hidden');$('.trades-table').removeClass('hidden');initializeTradeTableEvents();wallet.loadAccountInfo(function(){wallet.runSynchronizerCallbacks();});}
setTimeout(tradeUpdateFunction,10000);});};});;"use strict";$(function(argument){$(document).trigger('fill-icon-fillers');var CONFIG=window.HORIZON_CONFIG;var wallet=window.getCurrentUserWallet();if(!wallet){return;}
var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);var getRenderedOffers=function(records){var transformedOffers=[];var trade=null;for(var i=0;i<records.length;i++){trade=new Offer(records[i],wallet.address);transformedOffers.push(trade);}
return Handlebars.templates.offer_body_table({'offers':transformedOffers,'closeIcon':$('#close-icon-url').attr('data-value'),'confirmed':$('#user-confirmed').attr('data-value')=='true',});};var offersHandler=function(response,repeat){if($('.offers-table .cancel-offer.disabled').length===0){if(response.records.length>0){var renderedTrades=getRenderedOffers(response.records);$('.offers-table .row.data').remove();$('.offers-table').append(renderedTrades);$('.offers-table').removeClass("hidden");$('#active-orders-tab .empty-tab-message-wrapper').addClass('hidden');$('.cancel-offer').on('click',function(event){event.preventDefault();var $this=$(this);if($this.hasClass('disabled')){return;}else{$this.addClass('disabled');}
$.ajax({type:"DELETE",url:$('#offer-cancel-url').attr('data-value'),data:{"offer_id":$this.attr('data-offer-id')},beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val()),}).then(function(d){return transactionSigner.signTransaction(d.xdr);}).then(function(xdr){return sendXdrToHorizon(xdr);}).fail(function(xhr,textStatus){console.log(arguments);var response=xhr.responseJSON;var errors=response.errors;if(response.status=="needed_additional_signature"){window.showMoreSignaturesNeededPopup(response.detail,response.envelope_xdr);return;}
var errorText=gettext("Something went wrong");if(response){errorText=response.detail||response.details;}
$('.alert.cancel-offer-alert').html(errorText).removeClass('hidden');setTimeout(function(){$('.alert.cancel-offer-alert').addClass('hidden');},5000);}).done(function(data){updateOffers(false);if(data.detail){$('.alert.cancel-offer-alert').html(data.detail).removeClass('hidden').removeClass('alert-danger').addClass('alert-success');setTimeout(function(){$('.alert.cancel-offer-alert').addClass('hidden').removeClass('alert-success').addClass('alert-danger');},5000);}
wallet.loadAccountInfo(function(){wallet.runSynchronizerCallbacks();});}).always(function(){$this.removeClass('disabled');});});}else{$('.offers-table').addClass("hidden");$('#active-orders-tab .empty-tab-message-wrapper').removeClass('hidden');}
$('.active-offers-count').html(response.records.length);}
if(repeat){setTimeout(updateOffers,10000);}};var updateOffers=function(repeat){if(repeat===undefined){repeat=true;}
if(wallet.address){horizon.offers().forAccount(wallet.address).limit(200).call().then(function(response){offersHandler(response,repeat);});}};updateOffers();$(document).on('update-offers-table',function(event){updateOffers(false);});});;"use strict";$(function(argument){var CONFIG=window.HORIZON_CONFIG;var stream=null;var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);var wallet=window.getCurrentUserWallet();var counterAsset=null;var baseAsset=null;var price=null;var isSelling=null;var lastTradePriceAlternative=null;var orderbookSize=10;var setDefaultPrice=true;var updateLastPrice=function(lastPrice,isSelling){if(!lastPrice){$('.counter-asset-price').closest('.statistic-item').addClass('hidden');checkMarketStat();return;}else{$('.counter-asset-price').closest('.statistic-item').removeClass('hidden');}
$('.counter-asset-price').html(truncateZeros(parseFloat(lastPrice).toFixed(7)));if(isSelling){$('.counter-asset-price').closest('last-trade').removeClass('buying').addClass('selling');}else{$('.counter-asset-price').closest('last-trade').removeClass('selling').addClass('buying');}
var assetBalance=wallet.getAssetBalanceByAssetData(baseAsset.code,baseAsset.issuer);if(assetBalance&&assetBalance.alternative_rate&&assetBalance.alternative_rate.symbol&&assetBalance.alternative_rate.rate&&lastPrice){lastTradePriceAlternative="{0}{1}".format(assetBalance.alternative_rate.symbol,parseFloat(assetBalance.alternative_rate.rate*lastPrice).toFixed(9));$('.counter-asset-alternative-price').html(lastTradePriceAlternative).closest('.counter-asset-alternative-price-wrapper').removeClass('hidden');$('.last-trade').parent().removeClass('hidden');}else{$('.counter-asset-alternative-price').closest('.counter-asset-alternative-price-wrapper').addClass('hidden');$('.last-trade').parent().addClass('hidden');}};var calculateFractionPartAccuracy=function(number){var defaultAccuracy=7
var minWholePartDigits=7
var maxWholePartDigits=13
var wholePart=Math.floor(number);var wholePartNumberOfDigits=wholePart.toString().length;if(wholePartNumberOfDigits<minWholePartDigits){return defaultAccuracy}
if(wholePartNumberOfDigits>maxWholePartDigits){return 1}
return defaultAccuracy-(wholePartNumberOfDigits-defaultAccuracy)}
var prepareOrderbookRows=function(rows,maxValue){if(!rows||!rows.length){return;}
var price,priceAccuracy,total,totalAccuracy,reverseAmount,reverseAmountAccuracy,amount,amountAccuracy;for(var i=0;i<rows.length;i++){price=parseFloat(rows[i].price);priceAccuracy=calculateFractionPartAccuracy(price);total=rows[i].price*rows[i].amount;totalAccuracy=calculateFractionPartAccuracy(total);reverseAmount=rows[i].amount/rows[i].price;reverseAmountAccuracy=calculateFractionPartAccuracy(reverseAmount);amount=rows[i].amount;amountAccuracy=calculateFractionPartAccuracy(amount);rows[i].price=truncateZeros(Math.floor10(price,-priceAccuracy));rows[i].percentage=Math.ceil(rows[i].amount/maxValue*100);rows[i].total=truncateZeros(Math.floor10(total,-totalAccuracy));rows[i].reverse_amount=truncateZeros(Math.floor10(reverseAmount,-reverseAmountAccuracy));rows[i].amount=truncateZeros(Math.floor10(amount,-amountAccuracy));}}
var orderbookMessageHandler=function(orderbookMessage){if((!orderbookMessage.asks||orderbookMessage.asks.length==0)&&(!orderbookMessage.bids||orderbookMessage.bids.length==0)){$('.orderbook-col').addClass('hidden');$('.spread-value').closest('.statistic-item').addClass('hidden');checkMarketStat();}else{$('.orderbook-col').removeClass('hidden');}
orderbookMessage.baseAsset=baseAsset;orderbookMessage.counterAsset=counterAsset;if(price){orderbookMessage.lastTradePrice=truncateZeros(price.toFixed(9));orderbookMessage.lastTradeIsSelling=isSelling;orderbookMessage.lastTradePriceAlternative=lastTradePriceAlternative;}
orderbookMessage.asks=orderbookMessage.asks.reverse();orderbookMessage.maxAskAmount=Math.max.apply(Math,orderbookMessage.asks.map(function(o){return o.amount;}));orderbookMessage.maxBidAmount=Math.max.apply(Math,orderbookMessage.bids.map(function(o){return o.amount;}));prepareOrderbookRows(orderbookMessage.asks,orderbookMessage.maxAskAmount);prepareOrderbookRows(orderbookMessage.bids,orderbookMessage.maxBidAmount);if(orderbookMessage.asks&&orderbookMessage.asks.length>0&&orderbookMessage.bids&&orderbookMessage.bids.length>0){var spread=orderbookMessage.asks[orderbookMessage.asks.length-1].price-orderbookMessage.bids[0].price;var spreadValue=truncateZeros((spread/orderbookMessage.asks[orderbookMessage.asks.length-1].price*100).toFixed(4));$('.spread-value').html(spreadValue);$('.spread-value').closest('.statistic-item').removeClass('hidden');}else{$('.spread-value').closest('.statistic-item').addClass('hidden');checkMarketStat();}
if(setDefaultPrice){if(orderbookMessage.asks.length>0){let defaultPrice=truncateZeros(orderbookMessage.asks[orderbookMessage.asks.length-1].price);$("#id-buy-limit-form input[name='price']").val(defaultPrice);$("#id-buy-market-form input[name='price']").val(defaultPrice);}
if(orderbookMessage.bids.length>0){let defaultPrice=truncateZeros(orderbookMessage.bids[0].price);$("#id-sell-limit-form input[name='price']").val(defaultPrice);$("#id-sell-market-form input[name='price']").val(defaultPrice);}
$("#id-buy-market-form input[name='amount']").val('').change();setTimeout(function(){$("#id-sell-market-form input[name='amount']").val('').change();},600);setDefaultPrice=false;}
$('.orderbook-table').replaceWith(Handlebars.templates.orderbook(orderbookMessage));updateLastPrice(price,isSelling);$('.orderbook-table .price').on('click',function(event){var $form=$(".trading-form:visible");if($form.is('#id-buy-limit-form')||$form.is('#id-sell-limit-form')){$(".trading-form:visible [name='price']").val($(this).html().trim());$(".trading-form:visible [name='price']").trigger('change');}});};var configureOrderbook=function(){if(stream){stream();}
counterAsset=new StellarSdk.Asset($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));baseAsset=new StellarSdk.Asset($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));horizon.orderbook(counterAsset,baseAsset).limit(orderbookSize).call().then(function(message){orderbookMessageHandler(message);stream=horizon.orderbook(counterAsset,baseAsset).limit(orderbookSize).stream({onmessage:orderbookMessageHandler});});updateLastTradePrice();};var isLiquidityPoolTrade=function(trade){return trade.trade_type=='liquidity_pool';}
var isMinimalAmountsTrade=function(baseAmount,counterAmount){return baseAmount==0.0000001&&counterAmount==0.0000001}
var updateLastTradePrice=function(){if(!baseAsset||!counterAsset){return;}
horizon.trades().forAssetPair(baseAsset,counterAsset).order('desc').limit(10).call().then(function(response){if(response.records.length<=0){return;}
var trades=response.records
for(var i=0;i<trades.length;i++){var trade=trades[i];var baseAmount=parseFloat(trade.base_amount)
var counterAmount=parseFloat(trade.counter_amount)
if(isLiquidityPoolTrade(trade)&&isMinimalAmountsTrade(baseAmount,counterAmount)){if(!price&&isSelling===null){price=parseInt(trade.price.d)/parseInt(trade.price.n);isSelling=!trade.base_is_seller}
continue}
price=parseInt(trade.price.d)/parseInt(trade.price.n);isSelling=!trade.base_is_seller
break;}
if(!price&&isSelling===null){return;}
updateLastPrice(price,isSelling);});setTimeout(updateLastTradePrice,5000);};$(document).on('counter-asset-changed',configureOrderbook);});;"use strict";function ExchangeManager(){var server=new StellarSdk.Server($('#horizon-url').attr('data-value'));var bestStrictSendPath=Promise.resolve(undefined);var bestStrictReceivePath=Promise.resolve(undefined);function handleBestStrictSendPath(source_asset,dest_asset,amount){var strictSendPaths=server.strictSendPaths(source_asset,amount,[dest_asset]).call().then(page=>{if(page&&page.records){return page.records;}
return Promise.resolve(null);}).catch(()=>Promise.resolve(null));bestStrictSendPath=strictSendPaths.then(paths=>{if(!paths){return null;};var targetPaths;if(dest_asset.isNative()){targetPaths=paths.filter(path=>{return path.destination_asset_type=="native";});}else{targetPaths=paths.filter(path=>{return dest_asset.code==(path.destination_asset_code||"XLM")&&dest_asset.issuer==(path.destination_asset_issuer||null)});};return targetPaths.reduce((a,b)=>{return parseFloat(a.destination_amount)>parseFloat(b.destination_amount)?a:b});}).catch(()=>null)
return bestStrictSendPath;};function handleBestStrictReceivePath(source_asset,dest_asset,amount){var strictReceivePaths=server.strictReceivePaths([source_asset],dest_asset,amount).call().then(page=>{if(page&&page.records){return page.records;}
return Promise.resolve(null);}).catch(()=>Promise.resolve(null));bestStrictReceivePath=strictReceivePaths.then(paths=>{if(!paths){return null;};var targetPaths;if(source_asset.isNative()){targetPaths=paths.filter(path=>{return path.source_asset_type=="native";});}else{targetPaths=paths.filter(path=>{return source_asset.code==(path.source_asset_code||"XLM")&&source_asset.issuer==(path.source_asset_issuer||null)});};return targetPaths.reduce((a,b)=>{return parseFloat(a.source_amount)<parseFloat(b.source_amount)?a:b});}).catch(()=>null)
return bestStrictReceivePath;};function handleExchangeRateSend(source_asset,dest_asset){return handleBestStrictSendPath(source_asset,dest_asset,1).then(result=>{if(result){return truncateZeros(result.destination_amount);}});}
function handleExchangeRateReceive(source_asset,dest_asset){return handleBestStrictReceivePath(source_asset,dest_asset,1).then(result=>{if(result){return truncateZeros(result.source_amount);}});}
this.handleBestStrictSendPath=function(source_asset,dest_asset,amount){return handleBestStrictSendPath(source_asset,dest_asset,amount);};this.handleBestStrictReceivePath=function(source_asset,dest_asset,amount){return handleBestStrictReceivePath(source_asset,dest_asset,amount);};this.handleExchangeRateSend=function(source_asset,dest_asset){return handleExchangeRateSend(source_asset,dest_asset);}
this.handleExchangeRateReceive=function(source_asset,dest_asset){return handleExchangeRateReceive(source_asset,dest_asset);}
this.getBestStrictSendPath=function(){return bestStrictSendPath;};this.getBestStrictReceivePath=function(){return bestStrictReceivePath;};};var exchangeManager=new ExchangeManager();;"use strict";var wallet=window.getCurrentUserWallet();$(function(argument){var sellLimitFormValidator=null;var buyLimitFormValidator=null;var sellMarketFormValidator=null;var buyMarketFormValidator=null;$(document).trigger('fill-icon-fillers');$(function(){$("#navigation a[href='/trade']").addClass('active-menu');});var counterAssetChangeHandler=function(){$('.counter-asset-code').html($('.counter-asset').attr('data-asset-code'));$('.base-asset-code').html($('.base-asset').attr('data-asset-code'));};$(document).on('counter-asset-changed',counterAssetChangeHandler);$('.nav.form-tablist a[data-toggle="tab"]').on('hidden.bs.tab',function(e){var target=$(e.target).attr('href');$(target).find('form .alert').addClass('hidden');});$('.counter-asset-amount.selectable-asset-amount').on('click',function(event){event.preventDefault();var $this=$(this);var val=$this.html();$this.closest('form').find('[name="amount"]').val(val);$this.closest('form').find('[name="amount"]').trigger('change');});$('.base-asset-amount.selectable-asset-amount').on('click',function(event){event.preventDefault();var $this=$(this);var val=$this.html();$this.closest('form').find('[name="total"]').val(val);var price=$this.closest('form').find('[name="price"]').val();if(price){$this.closest('form').find('[name="amount"]').val(truncateZeros((val/price).toFixed(7)));}});var updateCounterAssetHandler=function(){var $asset=$('.trading-assets .counter-asset');var balance=wallet.getAssetBalanceByAssetData($asset.attr('data-asset-code'),$asset.attr('data-asset-issuer'));if(balance){var amount=balance.available_amount;if(balance.is_native){var isMarketTrade=$('#id-sell-type-form .choice-field').val()==='market';amount=amount-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;if(!isMarketTrade){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
var $base_asset=$('.trading-assets .base-asset');var base_balance=wallet.getAssetBalanceByAssetData($base_asset.attr('data-asset-code'),$base_asset.attr('data-asset-issuer'));if(!base_balance){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
if(amount<0){amount=0;}}
$asset.find('.balance').removeClass('hidden').find('.current-balance').html(balance.amount_human);$('.counter-asset-amount').html(truncateZeros(amount.toFixed(7)));$('.counter-asset-amount').attr('data-asset-code',balance.code);$('.counter-asset-amount').attr('data-asset-issuer',balance.issuer);}else{$(this).find('.balance').addClass('hidden');$('.counter-asset-amount').html(0);$('.counter-asset-amount').removeAttr('data-asset-code');$('.counter-asset-amount').removeAttr('data-asset-issuer');}};var updateBaseAssetHandler=function(){var $asset=$('.trading-assets .base-asset');var balance=wallet.getAssetBalanceByAssetData($asset.attr('data-asset-code'),$asset.attr('data-asset-issuer'));if(balance){var amount=balance.available_amount;if(balance.is_native){var isMarketTrade=$('#id-buy-type-form .choice-field').val()==='market';amount=amount-window.HORIZON_CONFIG.LOBSTR_RESERVED_BALANCE_XLM;if(!isMarketTrade){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
var $counter_asset=$('.trading-assets .counter-asset');var counter_balance=wallet.getAssetBalanceByAssetData($counter_asset.attr('data-asset-code'),$counter_asset.attr('data-asset-issuer'));if(!counter_balance){amount=amount-window.HORIZON_CONFIG.ENTRY_RESERVE;}
if(amount<0){amount=0;}}
$asset.find('.balance').removeClass('hidden').find('.current-balance').html(balance.amount_human);$('.base-asset-amount').html(truncateZeros(amount.toFixed(7)));$('.base-asset-amount').attr('data-asset-code',balance.code);$('.base-asset-amount').attr('data-asset-issuer',balance.issuer);}else{$(this).find('.balance').addClass('hidden');$('.base-asset-amount').html(0);$('.base-asset-amount').removeAttr('data-asset-code');$('.base-asset-amount').removeAttr('data-asset-issuer');}};var setFormValidationRules=function(){if(buyLimitFormValidator){buyLimitFormValidator.destroy();buyLimitFormValidator=null;}
if(sellLimitFormValidator){sellLimitFormValidator.destroy();sellLimitFormValidator=null;}
if(buyMarketFormValidator){buyMarketFormValidator.destroy();buyMarketFormValidator=null;}
if(sellMarketFormValidator){sellMarketFormValidator.destroy();sellMarketFormValidator=null;}
buyLimitFormValidator=$('#id-buy-limit-form').validate(getBuyFormValidationRule($('#id-buy-limit-form')));sellLimitFormValidator=$('#id-sell-limit-form').validate(getSellFormValidationRule($('#id-sell-limit-form')));buyMarketFormValidator=$('#id-buy-market-form').validate(getBuyFormValidationRule($('#id-buy-market-form')));sellMarketFormValidator=$('#id-sell-market-form').validate(getSellFormValidationRule($('#id-sell-market-form')));};var walletConfigurator=function(){setFormValidationRules();updateCounterAssetHandler();updateBaseAssetHandler();wallet.addSynchronizeCallback(setFormValidationRules);wallet.addSynchronizeCallback(updateCounterAssetHandler);wallet.addSynchronizeCallback(updateBaseAssetHandler);};$('#id-sell-type-form input').change(function(){updateCounterAssetHandler()});$('#id-buy-type-form input').change(function(){updateBaseAssetHandler()});wallet.loadAccountInfo(walletConfigurator,walletConfigurator);$(document).trigger('counter-asset-changed');});;"use strict";$(function(argument){$('.trading-form .col-form-label .actions .ask').on('click',function(e){e.preventDefault();var $form=$(this).closest('form');var price=$('.orderbook-table .row.data.ask .price').last().html();$form.find('[name="price"]').val(parseFloat(price));$form.find('[name="price"]').trigger('change');});$('.trading-form .col-form-label .actions .bid').on('click',function(e){e.preventDefault();var $form=$(this).closest('form');var price=$('.orderbook-table .row.data.bid .price').first().html();$form.find('[name="price"]').val(parseFloat(price));$form.find('[name="price"]').trigger('change');});$('.trading-form .col-form-label .actions .last').on('click',function(e){e.preventDefault();var $form=$(this).closest('form');var price=$('.orderbook-table .counter-asset-price').first().html();$form.find('[name="price"]').val(parseFloat(price));$form.find('[name="price"]').trigger('change');});var $formInputs=$('#id-sell-limit-form [name="amount"], #id-sell-limit-form [name="price"], #id-sell-limit-form [name="total"], '+'#id-buy-limit-form [name="amount"], #id-buy-limit-form [name="price"], #id-buy-limit-form [name="total"]'),formLastChangedField={};$formInputs.on('input keyup keydown change',function(event){var $form=$(this).closest('form');var price=$form.find('[name="price"]').val();var amount=$form.find('[name="amount"]').val();var total=$form.find('[name="total"]').val();var lastChangedField=formLastChangedField[$form.attr('id')];if($(this).attr('name')!='price'){formLastChangedField[$form.attr('id')]=$(this).attr('name');}
if(!lastChangedField){lastChangedField=formLastChangedField[$form.attr('id')];}
if(lastChangedField=='amount'){total=truncateZeros((amount*price).toFixed(7));if(total){$form.find('[name="total"]').val(total);}}else if(lastChangedField=='total'){amount=truncateZeros((total/price).toFixed(7));if(amount){$form.find('[name="amount"]').val(amount);}}
$form.find('.alert').addClass('hidden');if(event.originalEvent){let $closestMarketForm=$('#'+$form.attr('id').replace('limit','market'));$closestMarketForm.find('[name="amount"]').val(amount).change();}});var successResponseHandler=function(response,form){form.find('[name="amount"], [name="total"]').val('');$(document).trigger('update-offers-table');form.find('[type="submit"]').prop('disabled',false);let closestMarketForm=$('#'+form.attr('id').replace('limit','market'));closestMarketForm.find('[name="amount"], [name="total"]').val('');var message='Offer successfully created';if(response.detail){message=response.detail;}
form.find('.alert').removeClass('alert-danger').addClass('alert-success').removeClass('hidden').html(message);setTimeout(function(){form.find('.alert').addClass('hidden');},5000);wallet.loadAccountInfo(function(){wallet.runSynchronizerCallbacks();});};var createBuyOffer=function(form){var $this=$(form);var price=null;var priceFieldValue=parseFloat($this.find('[name="price"]').val());price=priceFieldValue;$.ajax({type:'POST',url:$this.attr('action'),data:{'buying_asset_code':$('.counter-asset').attr('data-asset-code'),'buying_asset_issuer':$('.counter-asset').attr('data-asset-issuer'),'selling_asset_code':$('.base-asset').attr('data-asset-code'),'selling_asset_issuer':$('.base-asset').attr('data-asset-issuer'),'amount':$this.find('[name="amount"]').val(),'price':price,},beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val())}).then(function(d){return transactionSigner.signTransaction(d.xdr);}).then(function(xdr){return sendXdrToHorizon(xdr);}).done(function(data){successResponseHandler(data,$this);}).fail(function(response){failedRequestHandler(response,$this,wallet);});};$('#id-buy-limit-form').submit(function(event){event.preventDefault();var $this=$(this);if(!$this.valid()){return;}
if(!checkAvailableNativeAmount($this)){return}
$this.find('[type="submit"]').prop('disabled',true);$this.find('.alert').addClass('hidden');createBuyOffer($this);});$('#id-sell-limit-form').submit(function(event){event.preventDefault();var price=null;var $this=$(this);if(!$this.valid()){return;}
if(!checkAvailableNativeAmount($this)){return}
$this.find('[type="submit"]').prop('disabled',true);$this.find('.alert').addClass('hidden');var priceFieldValue=parseFloat($this.find('[name="price"]').val());price=priceFieldValue;$.ajax({type:'POST',url:$this.attr('action'),data:{'selling_asset_code':$('.counter-asset').attr('data-asset-code'),'selling_asset_issuer':$('.counter-asset').attr('data-asset-issuer'),'buying_asset_code':$('.base-asset').attr('data-asset-code'),'buying_asset_issuer':$('.base-asset').attr('data-asset-issuer'),'amount':$this.find('[name="amount"]').val(),'price':price,},beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val())}).then(function(d){return transactionSigner.signTransaction(d.xdr);}).then(function(xdr){return sendXdrToHorizon(xdr);}).done(function(data){successResponseHandler(data,$this);}).fail(function(response){failedRequestHandler(response,$this,wallet);});});});;"use strict";$(function(argument){var $formInputs=$('#id-sell-market-form [name="amount"], #id-sell-market-form [name="price"], #id-sell-market-form [name="total"], '+'#id-buy-market-form [name="amount"], #id-buy-market-form [name="price"], #id-buy-market-form [name="total"]'),formLastChangedField={};var pathFinderDelayTimer=null;var disableSubmitBtn=function(form){form.find('[type="submit"]').prop('disabled',true);form.find('[type="submit"]').addClass('disabled').addClass('no-spinner');}
var enableSubmitBtn=function(form){form.find('[type="submit"]').prop('disabled',false);form.find('[type="submit"]').removeClass('disabled').removeClass('no-spinner');}
$formInputs.on('input keyup keydown change',function(event){clearTimeout(pathFinderDelayTimer);var $form=$(this).closest('form');var amount=$form.find('[name="amount"]').val();var price=$form.find('[name="price"]').val();var total=$form.find('[name="total"]').val();var lastChangedField=formLastChangedField[$form.attr('id')];if($(this).attr('name')!='price'){formLastChangedField[$form.attr('id')]=$(this).attr('name');}
if(!lastChangedField){lastChangedField=formLastChangedField[$form.attr('id')];}
$form.find('.alert').addClass('hidden');if(event.originalEvent){let $closestLimitForm=$('#'+$form.attr('id').replace('market','limit'));$closestLimitForm.find('[name="amount"]').val(amount).change();}
var buying_asset_code=$('.counter-asset').attr('data-asset-code');var buying_asset_issuer=$('.counter-asset').attr('data-asset-issuer');var selling_asset_code=$('.base-asset').attr('data-asset-code');var selling_asset_issuer=$('.base-asset').attr('data-asset-issuer');var source_asset=new StellarSdk.Asset(selling_asset_code,selling_asset_issuer);var dest_asset=new StellarSdk.Asset(buying_asset_code,buying_asset_issuer);pathFinderDelayTimer=setTimeout(function(){if($form.is('#id-buy-market-form')){if(lastChangedField=='amount'){if(!Number(amount)){exchangeManager.handleExchangeRateReceive(source_asset,dest_asset).then(price=>{if(price){$form.find('[name="price"]').val(price);}
if(amount===''){$form.find('[name="total"]').val('');}else{$form.find('[name="total"]').val('0');}
enableSubmitBtn($form);});}else{exchangeManager.handleBestStrictReceivePath(source_asset,dest_asset,amount).then(result=>{if(result!=null){total=truncateZeros(result.source_amount);price=truncateZeros((total/amount).toFixed(7));if(price){$form.find('[name="price"]').val(price);}
if(total){$form.find('[name="total"]').val(total);}
enableSubmitBtn($form);}else{disableSubmitBtn($form);}});}}else if(lastChangedField=='total'){if(!Number(total)){exchangeManager.handleExchangeRateSend(source_asset,dest_asset).then(price=>{if(price){$form.find('[name="price"]').val(price);}
if(total===''){$form.find('[name="amount"]').val('');}else{$form.find('[name="amount"]').val('0');}
enableSubmitBtn($form);})}else{exchangeManager.handleBestStrictSendPath(source_asset,dest_asset,total).then(result=>{if(result!=null){amount=truncateZeros(result.destination_amount);price=truncateZeros((total/amount).toFixed(7));if(price){$form.find('[name="price"]').val(price);}
if(amount){$form.find('[name="amount"]').val(amount);}
enableSubmitBtn($form);}else{disableSubmitBtn($form);}});}}}else{[source_asset,dest_asset]=[dest_asset,source_asset];if(lastChangedField=='amount'){if(!Number(amount)){exchangeManager.handleExchangeRateSend(source_asset,dest_asset).then(price=>{if(price){$form.find('[name="price"]').val(price);}
if(amount===''){$form.find('[name="total"]').val('');}else{$form.find('[name="total"]').val('0');}
enableSubmitBtn($form);});}else{exchangeManager.handleBestStrictSendPath(source_asset,dest_asset,amount).then(result=>{if(result!=null){total=truncateZeros(result.destination_amount);price=truncateZeros((total/amount).toFixed(7));if(price){$form.find('[name="price"]').val(price);}
if(total){$form.find('[name="total"]').val(total);}
enableSubmitBtn($form);}else{disableSubmitBtn($form);}});}}else if(lastChangedField=='total'){if(!Number(total)){exchangeManager.handleExchangeRateReceive(source_asset,dest_asset).then(price=>{if(price){$form.find('[name="price"]').val(price);}
if(total===''){$form.find('[name="amount"]').val('');}else{$form.find('[name="amount"]').val('0');}
enableSubmitBtn($form);});}else{exchangeManager.handleBestStrictReceivePath(source_asset,dest_asset,total).then(result=>{if(result!=null){amount=truncateZeros(result.source_amount);price=truncateZeros((total/amount).toFixed(7));if(price){$form.find('[name="price"]').val(price);}
if(amount){$form.find('[name="amount"]').val(amount);}
enableSubmitBtn($form);}else{disableSubmitBtn($form);}});}}}},500);});var successResponseHandler=function(response,form){form.find('[name="amount"], [name="total"]').val('');$(document).trigger('update-offers-table');form.find('[type="submit"]').prop('disabled',false);let closestLimitForm=$('#'+form.attr('id').replace('market','limit'));closestLimitForm.find('[name="amount"], [name="total"]').val('');var message='Offer successfully filled';if(response.detail){message=response.detail;}
form.find('.alert').removeClass('alert-danger').addClass('alert-success').removeClass('hidden').html(message);setTimeout(function(){form.find('.alert').addClass('hidden');},5000);wallet.loadAccountInfo(function(){wallet.runSynchronizerCallbacks();});};var callStrictReceive=function(form,source_asset,dest_asset,amount){var apiEndpoint=$('#id-buy-market-form').attr('action');exchangeManager.handleBestStrictReceivePath(source_asset,dest_asset,amount).then(result=>{var path=result.path;if(path.length!=0){path=path.map(asset=>({'code':asset.asset_code||'XLM','issuer':asset.asset_issuer||null}));};var send_max=parseFloat(result.source_amount)/0.99;return $.ajax({type:'POST',contentType:'application/json; charset=utf-8',url:apiEndpoint,data:JSON.stringify({'send_asset':{'code':source_asset.code,'issuer':source_asset.issuer,},'dest_asset':{'code':dest_asset.code,'issuer':dest_asset.issuer,},'path':path,'dest_amount':amount,'send_max':Math.ceil10(send_max,-7),}),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val())});}).then(response=>transactionSigner.signTransaction(response.xdr)).then(xdr=>sendXdrToHorizon(xdr)).then(response=>successResponseHandler(response,form)).catch(error=>failedRequestHandler(error,form,wallet));}
var callStrictSend=function(form,source_asset,dest_asset,amount){var apiEndpoint=$('#id-sell-market-form').attr('action');exchangeManager.handleBestStrictSendPath(source_asset,dest_asset,amount).then(result=>{var path=result.path;if(path.length!=0){path=path.map(asset=>({'code':asset.asset_code||'XLM','issuer':asset.asset_issuer||null}));};var dest_min=parseFloat(result.destination_amount)*0.99;return $.ajax({type:'POST',contentType:'application/json; charset=utf-8',url:apiEndpoint,data:JSON.stringify({'send_asset':{'code':source_asset.code,'issuer':source_asset.issuer,},'dest_asset':{'code':dest_asset.code,'issuer':dest_asset.issuer,},'path':path,'send_amount':amount,'dest_min':Math.ceil10(dest_min,-7),}),beforeSend:beforeSendCSRFConfig($('body').find('[name="csrfmiddlewaretoken"]').val())});}).then(response=>transactionSigner.signTransaction(response.xdr)).then(xdr=>sendXdrToHorizon(xdr)).then(response=>successResponseHandler(response,form)).catch(error=>failedRequestHandler(error,form,wallet));}
var createBuyExchange=function(form){var amount=form.find('[name="amount"]').val();var total=form.find('[name="total"]').val();var buying_asset_code=$('.counter-asset').attr('data-asset-code');var buying_asset_issuer=$('.counter-asset').attr('data-asset-issuer');var selling_asset_code=$('.base-asset').attr('data-asset-code');var selling_asset_issuer=$('.base-asset').attr('data-asset-issuer');var source_asset=new StellarSdk.Asset(selling_asset_code,selling_asset_issuer);var dest_asset=new StellarSdk.Asset(buying_asset_code,buying_asset_issuer);if(formLastChangedField[form.attr('id')]=='amount'){callStrictReceive(form,source_asset,dest_asset,amount);}
if(formLastChangedField[form.attr('id')]=='total'){callStrictSend(form,source_asset,dest_asset,total);}}
var createSellExchange=function(form){var amount=form.find('[name="amount"]').val();var total=form.find('[name="total"]').val();var buying_asset_code=$('.counter-asset').attr('data-asset-code');var buying_asset_issuer=$('.counter-asset').attr('data-asset-issuer');var selling_asset_code=$('.base-asset').attr('data-asset-code');var selling_asset_issuer=$('.base-asset').attr('data-asset-issuer');var source_asset=new StellarSdk.Asset(selling_asset_code,selling_asset_issuer);var dest_asset=new StellarSdk.Asset(buying_asset_code,buying_asset_issuer);[source_asset,dest_asset]=[dest_asset,source_asset];if(formLastChangedField[form.attr('id')]=='amount'){callStrictSend(form,source_asset,dest_asset,amount);}
if(formLastChangedField[form.attr('id')]=='total'){callStrictReceive(form,source_asset,dest_asset,total);}}
$('#id-buy-market-form').submit(function(event){event.preventDefault();var $this=$(this);if(!$this.valid()){return;}
if(!checkAvailableNativeAmount($this)){return}
$this.find('[type="submit"]').prop('disabled',true);$this.find('.alert').addClass('hidden');createBuyExchange($this);});$('#id-sell-market-form').submit(function(event){event.preventDefault();var $this=$(this);if(!$this.valid()){return;}
if(!checkAvailableNativeAmount($this)){return}
$this.find('[type="submit"]').prop('disabled',true);$this.find('.alert').addClass('hidden');createSellExchange($this);});});;"use strict";$(function(){var wallet=window.getCurrentUserWallet();var ASSET_SELECT_TYPE_CHOICES={BASE:1,COUNTER:2,};var SELECT_ASSET_TYPE=null;var counterAsset=new StellarSdk.Asset($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));var baseAsset=new StellarSdk.Asset($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));$('#select-asset a[href="#my-assets-tab"]').on('shown.bs.tab',function(event){event.preventDefault();$('#asset-search-query').val('');showMyAssets();})
$('#select-asset a[href="#all-assets-tab"]').on('shown.bs.tab',function(event){event.preventDefault();$('#asset-search-query').val('');showTrustAllowedAssets();})
$(".counter-asset").on('click',function(event){event.preventDefault();SELECT_ASSET_TYPE=ASSET_SELECT_TYPE_CHOICES.COUNTER;$('#select-asset').modal('show');});$(".base-asset").on('click',function(event){event.preventDefault();SELECT_ASSET_TYPE=ASSET_SELECT_TYPE_CHOICES.BASE;$('#select-asset').modal('show');});$('#asset-search-query').on('input',$.debounce(500,function(){searchAsset($(this).val());}));var handleTrustAllowedTab=function(){$('#asset-search-query').val('');if($('#all-assets-tab .trust-allowed-assets .asset-wrapper').length<=0){$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').removeClass('hidden');}else{$('#all-assets-tab .empty-tab-message-wrapper').addClass('hidden');$('#all-assets-tab .trust-allowed-assets').removeClass('hidden');}
$('#select-asset').find('.asset-tab-selector [href="#my-assets-tab"]').tab('show');}
$('#select-asset').on('hidden.bs.modal',function(event){handleTrustAllowedTab();showMyAssets();$('#all-assets-tab .asset-search-result').addClass('hidden');});var assetSelectHandler=function(event){if(SELECT_ASSET_TYPE==ASSET_SELECT_TYPE_CHOICES.BASE){assetSelectBaseAssetHandler(event,$(this))}else if(SELECT_ASSET_TYPE==ASSET_SELECT_TYPE_CHOICES.COUNTER){assetSelectCounterAssetHandler(event,$(this));}};var assetSelectCounterAssetHandler=function(event,$this){var newAsset=new StellarSdk.Asset($this.attr('data-asset-code'),$this.attr('data-asset-issuer'));counterAsset=newAsset;updatePath();};var assetSelectBaseAssetHandler=function(event,$this){var newAsset=new StellarSdk.Asset($this.attr('data-asset-code'),$this.attr('data-asset-issuer'));baseAsset=newAsset;updatePath();};var updatePath=function(){if(counterAsset.code==baseAsset.code&&counterAsset.issuer==baseAsset.issuer){if(SELECT_ASSET_TYPE==ASSET_SELECT_TYPE_CHOICES.BASE){var initialBaseAsset=new StellarSdk.Asset($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));counterAsset=initialBaseAsset;}else{var initialCounterAsset=new StellarSdk.Asset($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));baseAsset=initialCounterAsset;}}
if(counterAsset.isNative()){window.location.href="{0}/native/{1}:{2}".format($('#trade-view-url-template').attr('data-value'),baseAsset.code,baseAsset.issuer,);}else if(!counterAsset.isNative()&&!baseAsset.isNative()){window.location.href="{0}/{1}:{2}/{3}:{4}/".format($('#trade-view-url-template').attr('data-value'),counterAsset.code,counterAsset.issuer,baseAsset.code,baseAsset.issuer,);}else{window.location.href="{0}/{1}:{2}".format($('#trade-view-url-template').attr('data-value'),counterAsset.code,counterAsset.issuer,);}};var showTrustAllowedAssets=function(){if($('#all-assets-tab .trust-allowed-assets .asset-wrapper').length<=0){$('#all-assets-tab .asset-search-result').addClass('hidden');$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').removeClass('hidden');return;}
$('#all-assets-tab .empty-tab-message-wrapper').addClass('hidden');$('#all-assets-tab .asset-search-result').addClass('hidden');$('#all-assets-tab .trust-allowed-assets').removeClass('hidden');}
function showMyAssets(){let balances=getAssetsByQueryFromWallet(null);if(balances.length<=0){$('#my-assets-tab .assets-table').addClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').removeClass('hidden');$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);return;}
let html=Handlebars.templates.select_assets_popup_content({'asset_balances':balances});$('#my-assets-tab .assets-table').html(html);$('#my-assets-tab .assets-table').removeClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').addClass('hidden');$(document).trigger('fill-icon-fillers');$('.asset-info-cell-image-wrapper img').on('error',assetFillerErrorEventHandler);$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);}
var getAssetsByQuery=function(searchQuery){if(!searchQuery){searchQuery='';}
return $.ajax({type:"GET",url:$('#tradable-assets-list-url').attr('data-value')+'?search='+searchQuery,}).then(response=>{return response.results;}).catch(()=>null)}
var initializeTrustAllowedAssetsBlock=function(){var balances=wallet.allBalances;return Promise.all([getAssetsByQuery(),wallet.loadAssetRates(),wallet.loadAssetDetailsLight()]).then(results=>{var trustAllowedAssets=results[0];if(!trustAllowedAssets){return lobstrSort(balances);}
var tradableAssets=balances.concat(trustAllowedAssets);for(var i=0;i<tradableAssets.length;++i){for(var j=i+1;j<tradableAssets.length;++j){if(tradableAssets[i].code===tradableAssets[j].code&&(tradableAssets[i].issuer||null)===(tradableAssets[j].issuer||null)){tradableAssets.splice(j--,1);}}}
return lobstrSort(tradableAssets);}).catch(()=>{return lobstrSort(balances);}).then(balances=>{if(!balances||balances.length<=0){$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').removeClass('hidden');return;}
var html=Handlebars.templates.select_assets_popup_content({'asset_balances':balances});$('#all-assets-tab .trust-allowed-assets').html(html);$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);$(document).trigger('fill-icon-fillers');});}
var getAssetsByQueryFromWallet=function(searchQuery){var balances=wallet.allBalances;if(!searchQuery){return balances;}
searchQuery=searchQuery.toLowerCase();return balances.filter((el)=>{return(el.code?el.code:'').toLowerCase().includes(searchQuery)||(el.name?el.name:'').toLowerCase().includes(searchQuery)||(el.home_domain?el.home_domain:'').toLowerCase().includes(searchQuery);});}
var handleVerifiedAssets=function(tradableAssets,searchQuery,balances){let assetList=null;if(!tradableAssets||tradableAssets.length<=0){assetList=lobstrSort(balances);}else{assetList=balances.concat(tradableAssets);assetList=assetList.filter((i,idx,array)=>{return idx===array.findIndex((j)=>{return i.code===j.code&&(i.issuer||null)===(j.issuer||null);});});assetList=lobstrSort(assetList);}
return assetList}
var searchAsset=function(searchQuery){if(!searchQuery){showTrustAllowedAssets();showMyAssets();return}
var emptyResultDescriptionText=null
if(searchQuery.length>10){emptyResultDescriptionText='No results for "{0}...{1}" were found'.format(searchQuery.slice(0,4),searchQuery.slice(-4));}else{emptyResultDescriptionText='No results for "{0}" were found'.format(searchQuery)}
$('#my-assets-tab .empty-tab-message-wrapper .description').text(emptyResultDescriptionText);$('#my-assets-tab .empty-tab-message-wrapper .title').text('Nothing found');$('#all-assets-tab .empty-tab-message-wrapper .description').text(emptyResultDescriptionText);if(searchQuery.localeCompare($('#asset-search-query').val(),'en',{sensitivity:'accent'})!==0){return;}
searchQuery=searchQuery.toLowerCase()
if($('#select-asset a[aria-selected="true"][href="#my-assets-tab"]').length>0){let assets=getAssetsByQueryFromWallet(searchQuery);if(assets.length<=0){$('#my-assets-tab .assets-table').addClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').removeClass('hidden');return;}
let html=Handlebars.templates.select_assets_popup_content({'asset_balances':assets});$('#my-assets-tab .assets-table').html(html);$('#my-assets-tab .assets-table').removeClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').addClass('hidden');$(document).trigger('fill-icon-fillers');$('.asset-info-cell-image-wrapper img').on('error',assetFillerErrorEventHandler);$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);}else{getAssetsByQuery(searchQuery).then(tradableAssets=>{if(tradableAssets.length<=0){$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .asset-search-result').addClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').removeClass('hidden');return;}
let balances=getAssetsByQueryFromWallet(searchQuery);for(var i=0;i<tradableAssets.length;++i){for(var j=0;j<balances.length;++j){if(tradableAssets[i].code===balances[j].code&&tradableAssets[i].issuer===balances[j].issuer){tradableAssets[i]=balances[j]}}}
tradableAssets=handleVerifiedAssets(tradableAssets,searchQuery,balances);var html=Handlebars.templates.select_assets_popup_content({'asset_balances':tradableAssets});$('#all-assets-tab .asset-search-result').html(html);$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .asset-search-result').removeClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').addClass('hidden');$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);$(document).trigger('fill-icon-fillers');}).catch(()=>{$('#all-assets-tab .trust-allowed-assets').addClass('hidden');$('#all-assets-tab .asset-search-result').addClass('hidden');$('#all-assets-tab .empty-tab-message-wrapper').removeClass('hidden');})}};var updateAssetSelectPopup=function(){var balances=wallet.allBalances;return Promise.all([wallet.loadAssetRates(),wallet.loadAssetDetailsLight()]).then(()=>{return lobstrSort(balances);}).catch(()=>{return lobstrSort(balances);}).then(balances=>{if(!balances){$('#my-assets-tab .assets-table').addClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').removeClass('hidden');$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);return;}
var html=Handlebars.templates.select_assets_popup_content({'asset_balances':balances});$('#my-assets-tab .assets-table').html(html);$('#my-assets-tab .assets-table').removeClass('hidden');$('#my-assets-tab .empty-tab-message-wrapper').addClass('hidden');$(document).trigger('fill-icon-fillers');$('.asset-info-cell-image-wrapper img').on('error',assetFillerErrorEventHandler);}).then(()=>{$('.fluid-table.assets-table .row.asset-wrapper').on('click',assetSelectHandler);})};$(".swap-assets-button").on('click',function(){if(baseAsset.isNative()){window.location.href="{0}/native/{1}:{2}".format($('#trade-view-url-template').attr('data-value'),counterAsset.code,counterAsset.issuer,);}else if(!counterAsset.isNative()&&!baseAsset.isNative()){window.location.href="{0}/{1}:{2}/{3}:{4}/".format($('#trade-view-url-template').attr('data-value'),baseAsset.code,baseAsset.issuer,counterAsset.code,counterAsset.issuer,);}else{window.location.href="{0}/{1}:{2}".format($('#trade-view-url-template').attr('data-value'),baseAsset.code,baseAsset.issuer,);}})
var initializeSelectPopup=function(){Promise.all([updateAssetSelectPopup(),initializeTrustAllowedAssetsBlock()]).catch(()=>{return;}).then(()=>{$('.trading-assets').find('.base-asset, .counter-asset').removeClass('in-progress');}).then(()=>{if($('.asset-search-result.hidden').length<=0){return}
handleTrustAllowedTab();});}
wallet.loadAccountInfo(initializeSelectPopup,initializeSelectPopup);wallet.addRunAutoSynchronizerCallbacks(initializeSelectPopup);if(!wallet.address){initializeTrustAllowedAssetsBlock().then(()=>{$('.trading-assets').find('.base-asset, .counter-asset').removeClass('in-progress');})}});;$(function(){var handleAssetAlternativeRate=function(asset){return loadAssetAlternativeRate({'code':asset.code,'issuer':asset.issuer||null}).then(details=>{return details.alternative_rate;}).catch(()=>{return null});}
var handleTradeAggregation=function(counterAsset,baseAsset,startTime,endTime,resolution,offset){var CONFIG=window.HORIZON_CONFIG;var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);return horizon.tradeAggregation(counterAsset,baseAsset,startTime,endTime,resolution,offset,).limit(200).call().then(response=>{if(!response.records||response.records<=0){return null}
return response.records}).catch(()=>null);}
var loadSttatistic=function(){var wallet=window.getCurrentUserWallet();var resolution=900000;var counterAsset=new StellarSdk.Asset($(".counter-asset").attr("data-asset-code"),$(".counter-asset").attr("data-asset-issuer"));var baseAsset=new StellarSdk.Asset($(".base-asset").attr("data-asset-code"),$(".base-asset").attr("data-asset-issuer"));var startTime=moment().subtract(moment.duration(24,'h')).unix()*1000;var endTime=moment().unix()*1000+resolution;var getAssetRates=handleAssetAlternativeRate(baseAsset);var getTradeAggregation=handleTradeAggregation(counterAsset,baseAsset,startTime,endTime,resolution,0);Promise.all([getAssetRates,getTradeAggregation]).then(results=>{var assetRate=results[0];var tradeAggregationRecords=results[1];if(!assetRate||!tradeAggregationRecords){$('.statictic-block .day-change').closest('.statistic-item').addClass('hidden');$('.statictic-block .day-volume').closest('.statistic-item').addClass('hidden');checkMarketStat();return}
var close=parseFloat(tradeAggregationRecords[tradeAggregationRecords.length-1].close);var open=parseFloat(tradeAggregationRecords[0].open);var dayChange='--';if(close>0&&open>0){dayChange=(close/open-1)*100;dayChange=truncateZeros(dayChange.toFixed(2))+'%';}
var dayVolume=0;if(tradeAggregationRecords.length>1){dayVolume=tradeAggregationRecords.reduce(function(a,curr){return(a.counter_volume?parseFloat(a.counter_volume):a)+(curr.counter_volume?parseFloat(curr.counter_volume):0);});}else if(tradeAggregationRecords.length==1){dayVolume=tradeAggregationRecords[0].counter_volume;}
$('.statictic-block .day-change').html("{0}".format(dayChange));$('.statictic-block .day-change').closest('.statistic-item').removeClass('hidden');$('.statictic-block .day-volume').closest('.statistic-item').removeClass('hidden');$('.statictic-block .day-volume').html("{0} {1} ({2}{3})".format(parseFloat(dayVolume).toFixed(0),baseAsset.code,assetRate.symbol,truncateZeros((dayVolume*assetRate.rate).toFixed(3))));}).catch(()=>{$('.statictic-block .day-change').closest('.statistic-item').addClass('hidden');$('.statictic-block .day-volume').closest('.statistic-item').addClass('hidden');checkMarketStat();});};loadSttatistic();});;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['orderbook']=template({"1":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.asks:depth0),{"name":"each","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"2":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"            <div class=\"row data ask\">\n                <div class=\"cell price\">\n                    "
+alias2(alias1((depth0!=null?depth0.price:depth0),depth0))
+"\n                </div>\n                <div class=\"cell amount\">\n                    "
+alias2(alias1((depth0!=null?depth0.amount:depth0),depth0))
+"\n                </div>\n                <div class=\"cell total\">\n                    "
+alias2(alias1((depth0!=null?depth0.total:depth0),depth0))
+"\n                </div>\n                <div class=\"depth\" style=\"width: "
+alias2(alias1((depth0!=null?depth0.percentage:depth0),depth0))
+"%;\"></div>\n            </div>\n";},"4":function(container,depth0,helpers,partials,data){return"        <div class=\"no-filler\">\n            "
+container.escapeExpression((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"No active asks",{"name":"_","hash":{},"data":data}))
+"\n        </div>\n";},"6":function(container,depth0,helpers,partials,data){return"selling";},"8":function(container,depth0,helpers,partials,data){return"buying";},"10":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.bids:depth0),{"name":"each","hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"11":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"            <div class=\"row data bid\">\n                <div class=\"cell price\">\n                    "
+alias2(alias1((depth0!=null?depth0.price:depth0),depth0))
+"\n                </div>\n                <div class=\"cell amount\">\n                    "
+alias2(alias1((depth0!=null?depth0.reverse_amount:depth0),depth0))
+"\n                </div>\n                <div class=\"cell total\">\n                    "
+alias2(alias1((depth0!=null?depth0.amount:depth0),depth0))
+"\n                </div>\n                <div class=\"depth\" style=\"width: "
+alias2(alias1((depth0!=null?depth0.percentage:depth0),depth0))
+"%;\"></div>\n            </div>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3=container.escapeExpression,alias4=container.lambda,alias5="function";return"<div class=\"fluid-table orderbook-table\">\n    <div class=\"row head\">\n        <div class=\"cell head-cell price\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Price",{"name":"_","hash":{},"data":data}))
+"("
+alias3(alias4(((stack1=(depth0!=null?depth0.baseAsset:depth0))!=null?stack1.code:stack1),depth0))
+")</div>\n        <div class=\"cell head-cell amount\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Amount",{"name":"_","hash":{},"data":data}))
+"("
+alias3(alias4(((stack1=(depth0!=null?depth0.counterAsset:depth0))!=null?stack1.code:stack1),depth0))
+")</div>\n        <div class=\"cell head-cell total\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Total",{"name":"_","hash":{},"data":data}))
+"("
+alias3(alias4(((stack1=(depth0!=null?depth0.baseAsset:depth0))!=null?stack1.code:stack1),depth0))
+")</div>\n    </div>\n\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.asks:depth0),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")
+"\n    <div class=\"last-trade-wrapper justify-content-center align-items-center d-flex\">\n        <div class=\"hidden\">\n            <div class=\"last-trade-title\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Current price for",{"name":"_","hash":{},"data":data}))
+" "
+alias3(alias4(((stack1=(depth0!=null?depth0.counterAsset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n            <span class=\"last-trade "
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.lastTradeIsSelling:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.program(8,data,0),"data":data}))!=null?stack1:"")
+"\">\n                <span class=\"counter-asset-price\">"
+alias3(((helper=(helper=helpers.lastTradePrice||(depth0!=null?depth0.lastTradePrice:depth0))!=null?helper:alias2),(typeof helper===alias5?helper.call(alias1,{"name":"lastTradePrice","hash":{},"data":data}):helper)))
+"</span> "
+alias3(alias4(((stack1=(depth0!=null?depth0.baseAsset:depth0))!=null?stack1.code:stack1),depth0))
+"\n                <span class=\"counter-asset-alternative-price alternative-amount\">"
+alias3(((helper=(helper=helpers.lastTradePriceAlternative||(depth0!=null?depth0.lastTradePriceAlternative:depth0))!=null?helper:alias2),(typeof helper===alias5?helper.call(alias1,{"name":"lastTradePriceAlternative","hash":{},"data":data}):helper)))
+"</span>\n            </span>\n        </div>\n    </div>\n\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.bids:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")
+"</div>\n";},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['trade_table_body']=template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression,alias3=depth0!=null?depth0:(container.nullContext||{}),alias4=helpers.helperMissing;return"    <div class=\"row data history-row\" data-paging-token=\""
+alias2(alias1((depth0!=null?depth0.paging_token:depth0),depth0))
+"\" data-is-selling=\""
+alias2(alias1((depth0!=null?depth0.is_selling:depth0),depth0))
+"\" data-selling-amount=\""
+alias2(alias1((depth0!=null?depth0.selling_amount:depth0),depth0))
+"\" data-buying-amount=\""
+alias2(alias1((depth0!=null?depth0.buying_amount:depth0),depth0))
+"\" data-selling-code=\""
+alias2(alias1(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.code:stack1),depth0))
+"\" data-selling-issuer=\""
+alias2(alias1(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.issuer:stack1),depth0))
+"\" data-selling-price=\""
+alias2(alias1((depth0!=null?depth0.selling_price:depth0),depth0))
+"\" data-buying-code=\""
+alias2(alias1(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.code:stack1),depth0))
+"\" data-buying-issuer=\""
+alias2(alias1(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.issuer:stack1),depth0))
+"\" data-ledger-close-time=\""
+alias2(alias1((depth0!=null?depth0.ledger_close_time:depth0),depth0))
+"\">\n        <div class=\"cell side\">\n"
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")
+"        </div>\n        <div class=\"cell amount\">\n            "
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.program(8,data,0),"data":data}))!=null?stack1:"")
+alias2((helpers.toFixed||(depth0&&depth0.toFixed)||alias4).call(alias3,(depth0!=null?depth0.selling_amount:depth0),7,{"name":"toFixed","hash":{},"data":data}))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n        </div>\n        <div class=\"cell price\">\n            "
+alias2((helpers.toFixed||(depth0&&depth0.toFixed)||alias4).call(alias3,(depth0!=null?depth0.selling_price:depth0),9,{"name":"toFixed","hash":{},"data":data}))
+"\n        </div>\n        <div class=\"cell total\">\n            "
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0),"inverse":container.program(6,data,0),"data":data}))!=null?stack1:"")
+alias2((helpers.toFixed||(depth0&&depth0.toFixed)||alias4).call(alias3,(depth0!=null?depth0.buying_amount:depth0),7,{"name":"toFixed","hash":{},"data":data}))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n        </div>\n    </div>\n";},"2":function(container,depth0,helpers,partials,data){return"                <span class=\"offer-direction sell\">"
+container.escapeExpression((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Sell",{"name":"_","hash":{},"data":data}))
+"</span>\n";},"4":function(container,depth0,helpers,partials,data){return"                <span class=\"offer-direction buy\">"
+container.escapeExpression((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Buy",{"name":"_","hash":{},"data":data}))
+"</span>\n";},"6":function(container,depth0,helpers,partials,data){return"-";},"8":function(container,depth0,helpers,partials,data){return"+";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.trades:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['offer_body_table']=template({"1":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1,alias1=container.lambda,alias2=container.escapeExpression,alias3=depth0!=null?depth0:(container.nullContext||{});return"    <div class=\"row data\" data-paging-token=\""
+alias2(alias1((depth0!=null?depth0.paging_token:depth0),depth0))
+"\">\n        <div class=\"cell side\">\n"
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0,blockParams,depths),"inverse":container.program(4,data,0,blockParams,depths),"data":data}))!=null?stack1:"")
+"        </div>\n        <div class=\"cell amount\">\n"
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0,blockParams,depths),"inverse":container.program(8,data,0,blockParams,depths),"data":data}))!=null?stack1:"")
+"        </div>\n        <div class=\"cell price\">\n            "
+alias2((helpers.toFixed||(depth0&&depth0.toFixed)||helpers.helperMissing).call(alias3,(depth0!=null?depth0.price_display:depth0),9,{"name":"toFixed","hash":{},"data":data}))
+"\n        </div>\n        <div class=\"cell total\">\n"
+((stack1=helpers["if"].call(alias3,(depth0!=null?depth0.is_selling:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0,blockParams,depths),"inverse":container.program(12,data,0,blockParams,depths),"data":data}))!=null?stack1:"")
+"        </div>\n        <a class=\"cell cancel-offer "
+((stack1=helpers.unless.call(alias3,(depths[1]!=null?depths[1].confirmed:depths[1]),{"name":"unless","hash":{},"fn":container.program(14,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\" href=\"#\" data-offer-id=\""
+alias2(alias1((depth0!=null?depth0.id:depth0),depth0))
+"\">\n            <img src=\""
+alias2(alias1((depths[1]!=null?depths[1].closeIcon:depths[1]),depth0))
+"\">\n        </a>\n    </div>\n";},"2":function(container,depth0,helpers,partials,data){return"                <span class=\"offer-direction sell\">"
+container.escapeExpression((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Sell",{"name":"_","hash":{},"data":data}))
+"</span>\n";},"4":function(container,depth0,helpers,partials,data){return"                <span class=\"offer-direction buy\">"
+container.escapeExpression((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Buy",{"name":"_","hash":{},"data":data}))
+"</span>\n";},"6":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                -"
+alias2(alias1((depth0!=null?depth0.display_amount:depth0),depth0))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n";},"8":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                +"
+alias2(alias1((depth0!=null?depth0.display_amount:depth0),depth0))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n";},"10":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                +"
+alias2(alias1((depth0!=null?depth0.total_amount:depth0),depth0))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n";},"12":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                -"
+alias2(alias1((depth0!=null?depth0.total_amount:depth0),depth0))
+" <div class=\"help-text\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.code:stack1),depth0))
+"</div>\n";},"14":function(container,depth0,helpers,partials,data){return"hidden";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data,blockParams,depths){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:(container.nullContext||{}),(depth0!=null?depth0.offers:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0,blockParams,depths),"inverse":container.noop,"data":data}))!=null?stack1:"");},"useData":true,"useDepths":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['trade_details_popup']=template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=container.escapeExpression;return"    <div class=\"popup-row\">\n        <div class=\"name\">"
+alias1((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Selling asset issuer",{"name":"_","hash":{},"data":data}))
+"</div>\n        "
+alias1(container.lambda(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.issuer:stack1),depth0))
+"\n    </div>\n";},"3":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.is_native:stack1),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"4":function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3=container.escapeExpression;return"        <div class=\"popup-row\">\n            <div class=\"name\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Selling asset issuer",{"name":"_","hash":{},"data":data}))
+"</div>\n            "
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Native",{"name":"_","hash":{},"data":data}))
+"\n        </div>\n";},"6":function(container,depth0,helpers,partials,data){var stack1,alias1=container.escapeExpression;return"    <div class=\"popup-row\">\n        <div class=\"name\">"
+alias1((helpers._||(depth0&&depth0._)||helpers.helperMissing).call(depth0!=null?depth0:(container.nullContext||{}),"Buying asset issuer",{"name":"_","hash":{},"data":data}))
+"</div>\n        "
+alias1(container.lambda(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.issuer:stack1),depth0))
+"\n    </div>\n";},"8":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:(container.nullContext||{}),((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.is_native:stack1),{"name":"if","hash":{},"fn":container.program(9,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"9":function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3=container.escapeExpression;return"        <div class=\"popup-row\">\n            <div class=\"name\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Buying asset issuer",{"name":"_","hash":{},"data":data}))
+"</div>\n            "
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Native",{"name":"_","hash":{},"data":data}))
+"\n        </div>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=depth0!=null?depth0:(container.nullContext||{}),alias2=helpers.helperMissing,alias3="function",alias4=container.escapeExpression,alias5=container.lambda;return"<button class=\"close-popup close-popup-button close\" type=\"button\" data-dismiss=\"modal\">\n    <img src=\""
+alias4(((helper=(helper=helpers.close_icon_url||(depth0!=null?depth0.close_icon_url:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"close_icon_url","hash":{},"data":data}):helper)))
+"\">\n</button>\n<div class=\"header\">\n    "
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Trade details",{"name":"_","hash":{},"data":data}))
+"\n</div>\n\n<div class=\"popup-row\">\n    <div class=\"name\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Trade time",{"name":"_","hash":{},"data":data}))
+"</div>\n    "
+alias4(((helper=(helper=helpers.time||(depth0!=null?depth0.time:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"time","hash":{},"data":data}):helper)))
+"\n</div>\n\n<div class=\"popup-row\">\n    <div class=\"name\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Selling amount",{"name":"_","hash":{},"data":data}))
+"</div>\n    "
+alias4(((helper=(helper=helpers.selling_amount||(depth0!=null?depth0.selling_amount:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"selling_amount","hash":{},"data":data}):helper)))
+"\n</div>\n<div class=\"popup-row\">\n    <div class=\"name\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Selling asset code",{"name":"_","hash":{},"data":data}))
+"</div>\n    "
+alias4(alias5(((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.code:stack1),depth0))
+"\n</div>\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.selling_asset:depth0))!=null?stack1.issuer:stack1),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.program(3,data,0),"data":data}))!=null?stack1:"")
+"\n<div class=\"popup-row\">\n    <div class=\"name\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Buying amount",{"name":"_","hash":{},"data":data}))
+"</div>\n    "
+alias4(((helper=(helper=helpers.buying_amount||(depth0!=null?depth0.buying_amount:depth0))!=null?helper:alias2),(typeof helper===alias3?helper.call(alias1,{"name":"buying_amount","hash":{},"data":data}):helper)))
+"\n</div>\n<div class=\"popup-row\">\n    <div class=\"name\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Buying asset code",{"name":"_","hash":{},"data":data}))
+"</div>\n    "
+alias4(alias5(((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.code:stack1),depth0))
+"\n</div>\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.buying_asset:depth0))!=null?stack1.issuer:stack1),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.program(8,data,0),"data":data}))!=null?stack1:"")
+"\n<div class=\"links mt30\">\n    <a href=\"#\" class=\"f-right new-button close-popup-button\" data-dismiss=\"modal\">"
+alias4((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Close",{"name":"_","hash":{},"data":data}))
+"</a>\n</div>\n";},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['select_assets_popup_content']=template({"1":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:{},alias2=container.lambda,alias3=container.escapeExpression;return"    <div class=\"row data asset-wrapper "
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.is_native:depth0),{"name":"if","hash":{},"fn":container.program(2,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\"\n         data-asset-id=\""
+alias3(alias2((depth0!=null?depth0.id:depth0),depth0))
+"\"\n         data-icon=\""
+alias3(alias2((depth0!=null?depth0.icon:depth0),depth0))
+"\"\n         data-name=\""
+alias3(alias2((depth0!=null?depth0.name:depth0),depth0))
+"\"\n         data-asset-code=\""
+alias3(alias2((depth0!=null?depth0.code:depth0),depth0))
+"\"\n         data-raw_amount=\""
+alias3(alias2((depth0!=null?depth0.raw_amount:depth0),depth0))
+"\"\n         data-home_domain=\""
+alias3(alias2((depth0!=null?depth0.home_domain:depth0),depth0))
+"\"\n         data-asset-issuer=\""
+alias3(alias2((depth0!=null?depth0.issuer:depth0),depth0))
+"\"\n         data-is_native=\""
+alias3(alias2((depth0!=null?depth0.is_native:depth0),depth0))
+"\"\n         data-background_color=\""
+alias3(alias2((depth0!=null?depth0.background_color:depth0),depth0))
+"\"\n     >\n        <div class=\"cell asset-info-cell\">\n            <div class=\"asset-info-cell-image-wrapper "
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.home_domain:depth0),{"name":"if","hash":{},"fn":container.program(4,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\">\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.icon:depth0),{"name":"if","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n                <div class=\"icon-filler "
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.icon:depth0),{"name":"if","hash":{},"fn":container.program(8,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\" data-color=\""
+alias3(alias2((depth0!=null?depth0.background_color:depth0),depth0))
+"\">\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.name:depth0),{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.program(13,data,0),"data":data}))!=null?stack1:"")
+"                </div>\n            </div>\n            <div class=\"asset-info-cell-name "
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.home_domain:depth0),{"name":"if","hash":{},"fn":container.program(11,data,0),"inverse":container.program(4,data,0),"data":data}))!=null?stack1:"")
+"\">\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.name:depth0),{"name":"if","hash":{},"fn":container.program(15,data,0),"inverse":container.program(17,data,0),"data":data}))!=null?stack1:"")
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.home_domain:depth0),{"name":"if","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"            </div>\n        </div>\n        <div class=\"cell pni asset-info-cell-amount\">\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.is_trusted:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"        </div>\n    </div>\n";},"2":function(container,depth0,helpers,partials,data){return"no-popup";},"4":function(container,depth0,helpers,partials,data){return"pt4";},"6":function(container,depth0,helpers,partials,data){return"                    <img src=\""
+container.escapeExpression(container.lambda((depth0!=null?depth0.icon:depth0),depth0))
+"\">\n";},"8":function(container,depth0,helpers,partials,data){return"hidden";},"10":function(container,depth0,helpers,partials,data){var stack1;return"                        "
+((stack1=(helpers.first_letter||(depth0&&depth0.first_letter)||helpers.helperMissing).call(depth0!=null?depth0:{},(depth0!=null?depth0.name:depth0),{"name":"first_letter","hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n";},"11":function(container,depth0,helpers,partials,data){return"";},"13":function(container,depth0,helpers,partials,data){var stack1;return"                        "
+((stack1=(helpers.first_letter||(depth0&&depth0.first_letter)||helpers.helperMissing).call(depth0!=null?depth0:{},(depth0!=null?depth0.code:depth0),{"name":"first_letter","hash":{},"fn":container.program(11,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n";},"15":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"                    "
+alias2(alias1((depth0!=null?depth0.name:depth0),depth0))
+" <span class=\"code\"> ("
+alias2(alias1((depth0!=null?depth0.code:depth0),depth0))
+") </span>\n";},"17":function(container,depth0,helpers,partials,data){var alias1=container.lambda,alias2=container.escapeExpression;return"                    "
+alias2(alias1((depth0!=null?depth0.code:depth0),depth0))
+" <span class=\"code\"> ("
+alias2(alias1((depth0!=null?depth0.code:depth0),depth0))
+") </span>\n";},"19":function(container,depth0,helpers,partials,data){return"                    <div class=\"home-domain asset-list-home-domain\">\n                        <span> "
+container.escapeExpression(container.lambda((depth0!=null?depth0.home_domain:depth0),depth0))
+" </span>\n                    </div>\n";},"21":function(container,depth0,helpers,partials,data){var stack1;return((stack1=(helpers.ifCond||(depth0&&depth0.ifCond)||helpers.helperMissing).call(depth0!=null?depth0:{},(depth0!=null?depth0.raw_amount:depth0),"!=",null,{"name":"ifCond","hash":{},"fn":container.program(22,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"22":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                    "
+alias2(alias1((depth0!=null?depth0.amount_human:depth0),depth0))
+" <span class=\"code\">"
+alias2(alias1((depth0!=null?depth0.code:depth0),depth0))
+"</span>\n                    "
+((stack1=(helpers.ifCond||(depth0&&depth0.ifCond)||helpers.helperMissing).call(depth0!=null?depth0:{},(depth0!=null?depth0.amount_human:depth0),">",0,{"name":"ifCond","hash":{},"fn":container.program(23,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"23":function(container,depth0,helpers,partials,data){var stack1;return"</br>\n"
+((stack1=helpers["if"].call(depth0!=null?depth0:{},(depth0!=null?depth0.is_native:depth0),{"name":"if","hash":{},"fn":container.program(24,data,0),"inverse":container.program(27,data,0),"data":data}))!=null?stack1:"");},"24":function(container,depth0,helpers,partials,data){var stack1;return((stack1=(helpers.ifCond||(depth0&&depth0.ifCond)||helpers.helperMissing).call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.alternative_balance:depth0))!=null?stack1.code:stack1),"!=","xlm",{"name":"ifCond","hash":{},"fn":container.program(25,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"25":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                                <span class=\"alternative_currency\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.alternative_balance:depth0))!=null?stack1.symbol:stack1),depth0))
+alias2(alias1(((stack1=(depth0!=null?depth0.alternative_balance:depth0))!=null?stack1.value:stack1),depth0))
+"</span>\n";},"27":function(container,depth0,helpers,partials,data){var stack1,alias1=container.lambda,alias2=container.escapeExpression;return"                            <span class=\"alternative_currency\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.alternative_balance:depth0))!=null?stack1.symbol:stack1),depth0))
+alias2(alias1(((stack1=(depth0!=null?depth0.alternative_balance:depth0))!=null?stack1.value:stack1),depth0))
+"</span>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers.each.call(depth0!=null?depth0:{},(depth0!=null?depth0.asset_balances:depth0),{"name":"each","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"useData":true});})();;(function(){var template=Handlebars.template,templates=Handlebars.templates=Handlebars.templates||{};templates['additional_action_required_popup']=template({"1":function(container,depth0,helpers,partials,data){var stack1;return"                <img src=\""
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.icon:stack1),depth0))
+"\">\n";},"3":function(container,depth0,helpers,partials,data){return"hidden";},"5":function(container,depth0,helpers,partials,data){var stack1;return"                    "
+((stack1=(helpers.first_letter||(depth0&&depth0.first_letter)||helpers.helperMissing).call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),{"name":"first_letter","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n";},"6":function(container,depth0,helpers,partials,data){return"";},"8":function(container,depth0,helpers,partials,data){var stack1;return"                    "
+((stack1=(helpers.first_letter||(depth0&&depth0.first_letter)||helpers.helperMissing).call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),{"name":"first_letter","hash":{},"fn":container.program(6,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n";},"10":function(container,depth0,helpers,partials,data){var stack1;return"                "
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),depth0))
+"\n";},"12":function(container,depth0,helpers,partials,data){var stack1;return"                "
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+"\n";},"14":function(container,depth0,helpers,partials,data){var stack1,helper,alias1=container.lambda,alias2=container.escapeExpression;return"                <span class=\"code\">\n                    ("
+alias2(alias1(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+")\n                </span>\n                <div class=\"home-domain\">\n                    <a href=\"https://"
+alias2(((helper=(helper=helpers.home_domain||(depth0!=null?depth0.home_domain:depth0))!=null?helper:helpers.helperMissing),(typeof helper==="function"?helper.call(depth0!=null?depth0:{},{"name":"home_domain","hash":{},"data":data}):helper)))
+"\" target=\"_blank\" rel=\"noopener noreferrer\">"
+alias2(alias1(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.home_domain:stack1),depth0))
+"</a>\n                </div>\n";},"16":function(container,depth0,helpers,partials,data){var stack1;return((stack1=helpers["if"].call(depth0!=null?depth0:{},((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),{"name":"if","hash":{},"fn":container.program(17,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"17":function(container,depth0,helpers,partials,data){var stack1;return"                    <div class=\"code\">\n                        ("
+container.escapeExpression(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.code:stack1),depth0))
+")\n                    </div>\n";},"19":function(container,depth0,helpers,partials,data){var helper,alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return"        <div class=\"popup-row\">\n            <div class=\"name\">\n                "
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Message",{"name":"_","hash":{},"data":data}))
+"\n            </div>\n            "
+alias3(((helper=(helper=helpers.message||(depth0!=null?depth0.message:depth0))!=null?helper:alias2),(typeof helper==="function"?helper.call(alias1,{"name":"message","hash":{},"data":data}):helper)))
+"\n        </div>\n";},"21":function(container,depth0,helpers,partials,data){var alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return"    <div class=\"links\">\n        <a href=\"#\" data-dismiss=\"modal\" class=\"f-right new-button close-popup-button\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Close",(depth0!=null?depth0.context:depth0),"Button",{"name":"_","hash":{},"data":data}))
+"</a>\n        <a href=\"#\" class=\"f-right new-button green action-url\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Continue",{"name":"_","hash":{},"data":data}))
+"</a>\n    </div>\n";},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data){var stack1,alias1=depth0!=null?depth0:{},alias2=helpers.helperMissing,alias3=container.escapeExpression;return"<div class=\"asset-info\">\n    <div class=\"header\">"
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Additional action required",{"name":"_","hash":{},"data":data}))
+"</div>\n    <div class=\"asset-info-header\">\n        <div class=\"asset-info-header-image-wrapper\">\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.icon:stack1),{"name":"if","hash":{},"fn":container.program(1,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\n            <div class=\"icon-filler "
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.icon:stack1),{"name":"if","hash":{},"fn":container.program(3,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"\" data-color=\""
+alias3(container.lambda(((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.background_color:stack1),depth0))
+"\">\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),{"name":"if","hash":{},"fn":container.program(5,data,0),"inverse":container.program(8,data,0),"data":data}))!=null?stack1:"")
+"            </div>\n        </div>\n        <div class=\"asset-info-header-name\">\n"
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.name:stack1),{"name":"if","hash":{},"fn":container.program(10,data,0),"inverse":container.program(12,data,0),"data":data}))!=null?stack1:"")
+((stack1=helpers["if"].call(alias1,((stack1=(depth0!=null?depth0.asset:depth0))!=null?stack1.home_domain:stack1),{"name":"if","hash":{},"fn":container.program(14,data,0),"inverse":container.program(16,data,0),"data":data}))!=null?stack1:"")
+"        </div>\n    </div>\n    <div class=\"asset-custom-description\">\n        "
+alias3((helpers._||(depth0&&depth0._)||alias2).call(alias1,"Asset issuer requires you to perform an additional action outside of LOBSTR.",{"name":"_","hash":{},"data":data}))
+"\n    </div>\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.message:depth0),{"name":"if","hash":{},"fn":container.program(19,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"")
+"</div>\n"
+((stack1=helpers["if"].call(alias1,(depth0!=null?depth0.isAddButtons:depth0),{"name":"if","hash":{},"fn":container.program(21,data,0),"inverse":container.noop,"data":data}))!=null?stack1:"");},"useData":true});})();;Chart.plugins.register({afterDatasetsDraw:function(chart){var drawCircle=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,x=activePoint.tooltipPosition().x,y=activePoint.tooltipPosition().y;ctx.beginPath();ctx.arc(x,y,4,0,2*Math.PI,false);ctx.fillStyle='#FFFFFF';ctx.fill();ctx.lineWidth=3;ctx.strokeStyle='#00abff';ctx.stroke();};function roundRect(ctx,x,y,width,height,radius,fill,stroke){if(typeof stroke=='undefined'){stroke=true;}
if(typeof radius==='undefined'){radius=5;}
if(typeof radius==='number'){radius={tl:radius,tr:radius,br:radius,bl:radius};}else{var defaultRadius={tl:0,tr:0,br:0,bl:0};for(var side in defaultRadius){radius[side]=radius[side]||defaultRadius[side];}}
ctx.beginPath();ctx.moveTo(x+radius.tl,y);ctx.lineTo(x+width-radius.tr,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius.tr);ctx.lineTo(x+width,y+height-radius.br);ctx.quadraticCurveTo(x+width,y+height,x+width-radius.br,y+height);ctx.lineTo(x+radius.bl,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius.bl);ctx.lineTo(x,y+radius.tl);ctx.quadraticCurveTo(x,y,x+radius.tl,y);ctx.closePath();if(fill){ctx.fill();}
if(stroke){ctx.strokeStyle=stroke;ctx.stroke();}}
var drawVerticalLine=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],x=activePoint.tooltipPosition().x,y=activePoint.tooltipPosition().y,topY=y_axis.top,bottomY=y_axis.bottom;ctx.save();ctx.beginPath();ctx.moveTo(x,topY);ctx.lineTo(x,bottomY);ctx.lineWidth=3;ctx.strokeStyle='#00abff';ctx.stroke();ctx.restore();};var drawYValue=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],topY=y_axis.top,x=activePoint.tooltipPosition().x,verticalPadding=5;var text="{0} {1}".format(activePoint._chart.config.data.datasets[0].data[activePoint._index].y,activePoint._chart.config.data.datasets[0].label);ctx.lineWidth=1;ctx.fillStyle='#FFFFFF';var horizontalPadding=10,startX=x-ctx.measureText(text).width/2-horizontalPadding-(ctx.lineWidth/2),endX=x+ctx.measureText(text).width/2+horizontalPadding,textHeight=12;if(ctx.canvas.clientWidth<endX){startX=ctx.canvas.clientWidth-(endX-startX);}
if(chart.scales['y-axis-0'].right>startX){startX=chart.scales['y-axis-0'].right;}
roundRect(ctx,startX,1,ctx.measureText(text).width+2*horizontalPadding,textHeight+2*verticalPadding,6,"#FFFFFF",'#00abff');ctx.font="{0}px Ubuntu".format(textHeight);ctx.fillStyle="rgba(0, 0, 0, 0.54)";ctx.textBaseline='middle';ctx.textAlign="left";ctx.fillText(text,startX+horizontalPadding,topY+ctx.lineWidth-12);};var drawXValue=function(chart){var activePoint=chart.tooltip._active[0],ctx=chart.ctx,y_axis=chart.scales['y-axis-0'],topY=y_axis.top,bottomY=y_axis.bottom,x=activePoint.tooltipPosition().x,verticalPadding=5;var text="{0}".format(chart.labels[activePoint._index]);var horizontalPadding=10,startX=x-ctx.measureText(text).width/2-horizontalPadding,endX=x+ctx.measureText(text).width/2+horizontalPadding,textHeight=12;ctx.lineWidth=1;ctx.fillStyle='#FFFFFF';if(ctx.canvas.clientWidth<endX){startX=ctx.canvas.clientWidth-(endX-startX);}
if(chart.scales['y-axis-0'].right>startX){startX=chart.scales['y-axis-0'].right-2;}
var areaHeight=textHeight+2*verticalPadding+2*ctx.lineWidth;roundRect(ctx,startX,bottomY-areaHeight/2,ctx.measureText(text).width+2*horizontalPadding,areaHeight,6,"#FFFFFF",'rgba(234, 234, 234, 0.78)');ctx.font="{0}px Ubuntu".format(textHeight);ctx.fillStyle="rgba(0, 0, 0, 0.54)";ctx.textBaseline='middle';ctx.textAlign="left";ctx.fillText(text,startX+horizontalPadding,bottomY);};if(chart.tooltip._active&&chart.tooltip._active.length){drawVerticalLine(chart);drawCircle(chart);drawYValue(chart);drawXValue(chart);}}});;$(function(){var myNewChart;var LABELS_COUNT=4;var DAY='DAY';var WEEK='WEEK';var MONTH='MONTH';var THREE_MONTHS='THREE_MONTHS';var YEAR='YEAR';var START_X_LABEL_PADDING=0.07;var displayPeriodChoices={'DAY':24,'WEEK':168,'MONTH':720,'THREE_MONTHS':2160,'YEAR':8760,};var timeFormatChoices={DAY:'LT',WEEK:'ddd hh A',MONTH:'MMM, DD',THREE_MONTHS:'MMM DD, YYYY',YEAR:'MMM, YYYY',};var baseStepChoicesForAssetChart={DAY:900000,WEEK:3600000,MONTH:86400000,THREE_MONTHS:86400000,YEAR:604800000,};var baseStepChoicesForLumenChart={DAY:600000,};var lastClickTimestamp=Date.now();var getDisplayPeriod=function(period){if(period<=displayPeriodChoices.DAY){return DAY;}else if(period<=displayPeriodChoices.WEEK){return WEEK;}else if(period<=displayPeriodChoices.MONTH){return MONTH;}else if(period<=displayPeriodChoices.THREE_MONTHS){return THREE_MONTHS;}else if(period){return YEAR;}
return YEAR;}
var updateCharts=function(){var period=$('.chart-periods .period.selected').attr('data-value');var periodKey=getDisplayPeriod(period);var counterAsset=null,baseAsset=new Asset({'code':StellarSdk.Asset.native().code,'issuer':StellarSdk.Asset.native().issuer});$('.chart .chart-loader-wrapper').show();if($('.selected-asset').length==2){counterAsset=new Asset({'code':$('.selected-asset.counter-asset').attr('data-asset-code'),'issuer':$('.selected-asset.counter-asset').attr('data-asset-issuer')||null});baseAsset=new Asset({'code':$('.selected-asset.base-asset').attr('data-asset-code'),'issuer':$('.selected-asset.base-asset').attr('data-asset-issuer')||null});}else if($('.selected-asset').length>0){counterAsset=new Asset({'code':$('.selected-asset').attr('data-asset-code'),'issuer':$('.selected-asset').attr('data-asset-issuer')||null});}
if(!counterAsset||(counterAsset.is_native&&baseAsset.is_native)){drawLobstrDataChart(period,periodKey);}else{drawAggregatedChart(period,periodKey,counterAsset,baseAsset);}};var drawAggregatedChart=function(period,periodKey,counterAsset,baseAsset){var CONFIG=window.HORIZON_CONFIG;var horizon=new StellarSdk.Server(CONFIG.HORIZON_URL);var resolution=baseStepChoicesForAssetChart[periodKey];var currencyCode=$('#chart-currency-code').attr('data-value');var clickTimestamp=Date.now();var lastClickTimestamp=clickTimestamp;if(period){var start_time=moment().subtract(moment.duration(parseInt(period),'h')).unix()*1000;}else{var start_time=moment("2014-01-01").unix()*1000;}
horizon.tradeAggregation(counterAsset.getStellarObject(),baseAsset.getStellarObject(),start_time,moment().unix()*1000+resolution,resolution,0).limit(200).call().then(function(response){if(lastClickTimestamp>clickTimestamp){return;}
resetChartHandler();var data=response.records;if(!data||data.length<2){return renderChartEmptyState();}
var open=parseFloat(data[0].open);var close=parseFloat(data[data.length-1].close);var rates=data.map(function(item){return{x:new Date(parseInt(item.timestamp)),y:parseFloat(item.avg)}});var extremeValues=data.reduce(function(a,b){var aHigh=parseFloat(a.high);var aLow=parseFloat(a.low);var bHigh=parseFloat(b.high);var bLow=parseFloat(b.low);return{high:Math.max(aHigh,bHigh),low:Math.min(aLow,bLow)}});return renderChart(counterAsset,currencyCode,rates,periodKey,resolution,open,close,extremeValues.high,extremeValues.low,baseAsset);}).catch(()=>{showNoDataMessage();$('.chart  .chart-loader-wrapper').hide();});};var drawLobstrDataChart=function(period,periodKey){var currencyCode=$('#chart-currency-code').attr('data-value');var resolution=baseStepChoicesForLumenChart[periodKey];var clickTimestamp=Date.now();var lastClickTimestamp=clickTimestamp;if(currencyCode==='XLM'){currencyCode='USD';}
var url=$('#exchange-rates-url').attr('data-value')+"?page_size=all&currency="+currencyCode+"&end_timestamp="+moment().unix();if(period){period=parseInt(period);url+="&start_timestamp="+moment().subtract(moment.duration(parseInt(period),'h')).unix();}
$.ajax({async:true,type:"GET",url:url,}).done(function(response){if(lastClickTimestamp>clickTimestamp){return;}
resetChartHandler();var data=response.results;if(!data||data.length<2){return renderChartEmptyState();}
var open=data[0].reverse_rate;var close=data[data.length-1].reverse_rate;var rates=data.map(function(item){return{x:new Date(item.timestamp*1000),y:item.reverse_rate}});var sortedDataValues=data.map(function(item){return item.reverse_rate}).sort();var low=sortedDataValues[0];var high=sortedDataValues[sortedDataValues.length-1];return renderChart(null,currencyCode,rates,periodKey,resolution,open,close,high,low);});};var showNoDataMessage=function(){$('.chart .box-content').addClass('hidden');$('.chart .no-chart-data-message').removeClass('hidden');$('.chart .chart-last-rate-info').addClass('invisible');};var hideNoDataMessage=function(){$('.chart .box-content').removeClass('hidden');$('.chart .no-chart-data-message').addClass('hidden');$('.chart .chart-last-rate-info').removeClass('invisible');};var getLabels=function(rates,periodKey,resolution){var labels=[];var min=new Date(rates[0].x);var max=new Date(rates[rates.length-1].x);var timeDifference=(max-min);var timeStep=timeDifference*(1-(START_X_LABEL_PADDING*2))/(LABELS_COUNT-1);var baseOffset=timeDifference*START_X_LABEL_PADDING;min.setTime(min.getTime()+baseOffset);var isNeedRoundLabels=function(timeDifference,periodKey,resolution){if(periodKey==DAY){return(timeDifference/(LABELS_COUNT+1))>=resolution}
return false};var isNeedRound=isNeedRoundLabels(timeDifference,periodKey,resolution);var roundTimeByPeriod=function(timestamp,resolution){return Math.round(timestamp/resolution)*resolution;};for(var i=0;i<LABELS_COUNT;i++){if(isNeedRound){min.setTime(roundTimeByPeriod(min.getTime(),resolution));}
labels.push(min);min=new Date(min.getTime()+timeStep);}
return labels};var getDatasetConfig=function(labelText,rates){return{label:labelText,pointRadius:0,fill:true,lineTension:0.1,borderWidth:1.5,data:rates};};var getOptions=function(periodKey,min,max){var updateYTicksOptions=function(ticks,min,max){var isValuesEqual=max==min;if(!isValuesEqual){return;}
if(max<=0){ticks['max']=0.0000001;ticks['min']=0;return;}
var DEFAULT_VALUE_CHANGE=0.1
var iterator=0;var approximation=null;var maxValue;var minValue;var valueDigit;do{valueDigit=Math.floor(Math.log10(max));valueDigit+=iterator;maxValue=Math.ceil10((max*(1+DEFAULT_VALUE_CHANGE)),valueDigit);minValue=Math.floor10((min*(1-DEFAULT_VALUE_CHANGE)),valueDigit);approximation=(max/maxValue)/(minValue/max);iterator-=1;}while(!approximation||(approximation<0.9||approximation>1.1));ticks['max']=maxValue;ticks['min']=minValue;};var layout={padding:{top:24,left:-5,},};var tooltips={enabled:false,mode:'x-axis',displayColors:false,callbacks:{title:function(){return"";}}};var xAxes=[{gridLines:{display:false},type:'time',time:{displayFormats:{hour:timeFormatChoices[periodKey],},unit:'hour',},ticks:{maxRotation:0,minRotation:0,padding:8,source:'labels',},afterFit:(scale)=>{scale.paddingRight=0;},}];var yAxes=[{gridLines:{display:false},ticks:{maxTicksLimit:6,padding:8,labelOffset:-5,},}];updateYTicksOptions(yAxes[0].ticks,min,max);var scales={xAxes:xAxes,yAxes:yAxes,};var legend={display:false,};return{layout:layout,tooltips:tooltips,scales:scales,legend:legend,};}
var renderChartEmptyState=function(){showNoDataMessage();$('.chart  .chart-loader-wrapper').hide();$('.box-header').show();}
var renderChart=function(counterAsset,currencyCode,rates,periodKey,resolution,open,close,high,low,baseAsset){var wallet=window.getCurrentUserWallet();var name=$('#chart-name').attr('data-value');var ctx=$("#"+name).get(0).getContext("2d");var wallet=window.getCurrentUserWallet();var ratesValues=[]
var labels=[]
if(!counterAsset&&!baseAsset){var labelText=currencyCode;}else{var labelText=baseAsset.code;}
if(!rates||rates.length===0){showNoDataMessage();}else{hideNoDataMessage();};$('.chart  .chart-loader-wrapper').hide();$('.box-header').show();if(rates.length<=1){myNewChart=new Chart(ctx,{type:'line',});wallet.runSynchronizerCallbacks();return};var ratesValues=rates.map(function(item){return item.y;});var sorted_rates=ratesValues.slice().sort(function(a,b){return(+a)-(+b);});var current=parseFloat(ratesValues[ratesValues.length-1]);renderStatInfo(name,current,labelText,low,high);labels=getLabels(rates,periodKey,resolution);var datasetConfig=getDatasetConfig(labelText,rates);setChartColorScheme(datasetConfig,ctx,name,open,close);var chart_data={labels:labels,datasets:[datasetConfig,]};var options=getOptions(periodKey,low,high);myNewChart=new Chart(ctx,{type:'line',data:chart_data,options:options});myNewChart.labels=rates.map(function(item,index){return moment(item.x).format("HH:mm DD-MM-YYYY");});wallet.runSynchronizerCallbacks();};var setChartColorScheme=function(datasetConfig,ctx,name,open,close){var line_color=null;var gradient=ctx.createLinearGradient(0,0,0,200);var change=0;if(open&&close){change=((close/open)-1)*100;}
change=parseFloat(change).toFixed(2);if(change>=0){if(change==0){$('#'+name+'_total').text('(0%)');$('.rate-img').attr('src','');}else{$('#'+name+'_total').text('(+ '+change+'%)');}
$('#'+name+'_total').addClass('green');gradient.addColorStop(0,'rgba(138,199,170,1)');gradient.addColorStop(1,'rgba(138,199,170,0)');line_color="#50c794";}else{$('#'+name+'_total').addClass('red');$('#'+name+'_total').text('(- '+(-change)+'%)');gradient.addColorStop(0,'rgba(255,100,100,1)');gradient.addColorStop(1,'rgba(255,100,100,0)');line_color="#D28273";}
datasetConfig.borderColor=line_color;datasetConfig.backgroundColor=gradient;};var renderStatInfo=function(name,current,labelText,min,max){$('#'+name+'_current').html('<span class="value">{0}</span> <span class="code">{1}</span>'.format(truncateZeros(current.toFixed(7)),labelText));$('#'+name+'_min').text('L: '+truncateZeros(min.toFixed(7)));$('#'+name+'_max').text('H: '+truncateZeros(max.toFixed(7)));};var resetStatInfo=function(name){$('#'+name+'_current').html('0');$('#'+name+'_min').text('L: 0');$('#'+name+'_max').text('H: 0');};updateCharts();var resetChartHandler=function(){if(myNewChart){resetStatInfo($('#chart-name').attr('data-value'));myNewChart.destroy();}};$(document).on('updateRateChart',function(){updateCharts();});$(document).on('resetRateChart',resetChartHandler);$('.chart-periods .period').on('click',function(e){$('.chart-periods .period').removeClass('selected');$(this).addClass('selected');$(document).trigger('updateRateChart');});});;